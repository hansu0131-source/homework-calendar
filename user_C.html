<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ğŸ° ë‚­ - ìˆ™ì œ ì²´í¬ë¦¬ìŠ¤íŠ¸</title>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore-compat.js"></script>

<style>
    body {
        background:#FFF8F2;
        margin:0; padding:16px;
        font-family:-apple-system,BlinkMacSystemFont,"Pretendard",sans-serif;
        color:#5a4638;
    }

    h1 {
        text-align:center;
        margin-bottom:6px;
        color:#ff9d6e;
        font-size:22px;
    }

    .top-msg {
        padding:10px;
        background:#fff3e6;
        border-radius:12px;
        box-shadow:0 2px 6px rgba(0,0,0,0.05);
        font-size:13px;
        line-height:1.4;
        margin-bottom:16px;
    }

    /* --- ìˆ™ì œ ìš”ì•½ ì¹´ë“œ --- */
    .summary-card {
        background:#ffffff;
        padding:12px;
        border-radius:14px;
        margin-bottom:14px;
        box-shadow:0 2px 8px rgba(0,0,0,0.07);
    }

    .summary-title {
        font-size:15px;
        font-weight:700;
        color:#ff8a3c;
        margin-bottom:8px;
    }

    .summary-line {
        display:flex;
        justify-content:space-between;
        padding:6px 10px;
        background:#fff7ef;
        border-radius:10px;
        margin-bottom:6px;
        font-size:13px;
    }

    .summary-name { font-weight:600; color:#333; }
    .summary-value { color:#ff7a3d; font-weight:700; }

    /* --- ì¹´ë“œ --- */
    .space-card {
        background:#ffffff;
        padding:12px;
        border-radius:14px;
        box-shadow:0 2px 10px rgba(0,0,0,0.07);
        margin-bottom:14px;
    }

    .nick {
        font-size:15px;
        font-weight:700;
        color:#ff8a3c;
        margin-bottom:6px;
    }

    .userid {
        font-size:12px;
        background:#fff1e2;
        padding:3px 8px;
        border-radius:30px;
        display:inline-block;
        margin-bottom:10px;
        color:#8b4b20;
    }

    .fields {
        margin-top:6px;
        display:flex;
        flex-wrap:wrap;
        gap:8px;
    }

    .field-chip {
        display:flex;
        align-items:center;
        gap:6px;
        padding:6px 10px;
        background:#fff6ed;
        border-radius:20px;
        font-size:12px;
    }

    .delete-btn {
        margin-top:10px;
        background:#ffe4e4;
        padding:6px 12px;
        border-radius:20px;
        border:none;
        font-size:12px;
        color:#ff4b4b;
        display:flex;
        align-items:center;
        gap:6px;
        cursor:pointer;
    }

    .delete-btn span {
        font-size:15px;
    }

</style>
</head>

<body>

<h1>ğŸ° ë‚­ - ìˆ™ì œ ì²´í¬ë¦¬ìŠ¤íŠ¸</h1>

<!-- ì˜¤ëŠ˜ì˜ í•œë§ˆë”” -->
<div class="top-msg" id="adminMessageBox">
    ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...
</div>

<!-- ì˜¤ëŠ˜ + ë°€ë¦° ìˆ™ì œ ìš”ì•½ -->
<div class="summary-card">
    <div class="summary-title">ğŸ“‹ ìˆ™ì œ ìš”ì•½</div>

    <div class="summary-line">
        <span class="summary-name">ì˜¤ëŠ˜ í•´ì•¼í•  ìˆ™ì œ</span>
        <span class="summary-value" id="todaySum">0 ê°œ</span>
    </div>
    <div class="summary-line">
        <span class="summary-name">ë°€ë¦° ìˆ™ì œ</span>
        <span class="summary-value" id="totalSum">0 ê°œ</span>
    </div>
</div>

<div id="spacesContainer"></div>

<script>
/* Firebase init */
firebase.initializeApp({
    apiKey:"AIzaSyAHmLNi5VOuAE-gXnAg-fEfzylPZvzvfVo",
    authDomain:"daily-checklist-91e5a.firebaseapp.com",
    projectId:"daily-checklist-91e5a"
});
const db=firebase.firestore();

/* Firestore references */
const msgRef = db.collection("today").doc("messages");
const summaryTodayRef = db.collection("summary").doc("today");
const summaryTotalRef = db.collection("summary").doc("total");
const configRef = db.collection("config").doc("checklist");
const spacesRef = db.collection("spaces");

let fields=[];
let spacesData=[];
    /* -------- ì˜¤ëŠ˜ì˜ í•œë§ˆë”” -------- */
msgRef.onSnapshot(doc=>{
    const box=document.getElementById("adminMessageBox");
    if(doc.exists){
        const msg=doc.data().adminMessage || "(ì•„ì§ ë©”ì‹œì§€ ì—†ìŒ)";
        box.textContent = msg;
    }
});

/* -------- ìš”ì•½ ì‹¤ì‹œê°„ -------- */
summaryTodayRef.onSnapshot(doc=>{
    const sum = doc.exists ?
        Object.values(doc.data()).filter(v=>typeof v==="number").reduce((a,b)=>a+b,0) : 0;
    document.getElementById("todaySum").textContent = sum+" ê°œ";
});

summaryTotalRef.onSnapshot(doc=>{
    const sum = doc.exists ?
        Object.values(doc.data()).filter(v=>typeof v==="number").reduce((a,b)=>a+b,0) : 0;
    document.getElementById("totalSum").textContent = sum+" ê°œ";
});

/* -------- í•­ëª© ë¡œë“œ -------- */
configRef.onSnapshot(doc=>{
    fields = doc.exists ? doc.data().fields || [] : [];
    renderSpaces();
});

/* -------- ëŒ€ìƒ ë¡œë“œ -------- */
spacesRef.onSnapshot(snap=>{
    spacesData = snap.docs.map(d=>({ id:d.id, ...d.data() }));
    renderSpaces();
});

/* -------- ì²´í¬ ë°˜ì˜ -------- */
function updateCheck(id,name,value){
    spacesRef.doc(id).update({
        ["checks."+name]:value
    });
}

/* -------- ì‚­ì œ -------- */
function deleteCard(id){
    if(!confirm("ì´ ìˆ™ì œ ì¹´ë“œë¥¼ ì‚­ì œí• ê¹Œìš”?")) return;
    spacesRef.doc(id).delete();
}

/* -------- ì¹´ë“œ ë Œë”ë§ -------- */
function renderSpaces(){
    const box=document.getElementById("spacesContainer");
    box.innerHTML="";

    spacesData.forEach(item=>{
        const checks = item.checks || {};

        let fieldHTML = fields.map(name => `
            <div class="field-chip">
                <input type="checkbox"
                    ${checks[name] ? "checked" : ""}
                    onchange="updateCheck('${item.id}','${name}',this.checked)">
                <span>${name}</span>
            </div>
        `).join("");

        box.innerHTML += `
            <div class="space-card">
                <div class="nick">ğŸ° ${item.nickname}</div>
                <div class="userid">@ ${item.userid}</div>

                <div class="fields">
                    ${fieldHTML}
                </div>

                <button class="delete-btn" onclick="deleteCard('${item.id}')">
                    <span>ğŸ°</span> ìˆ™ì œ ì™„ë£Œ!
                </button>
            </div>
        `;
    });
}
</script>

</body>
</html>


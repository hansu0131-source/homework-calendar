<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>C9 ìˆ™ì œ ìº˜ë¦°ë” (ë“±ë¡ ê¸°ëŠ¥ í¬í•¨)</title>
<style>
  /* --- ê¸°ë³¸ ìŠ¤íƒ€ì¼ --- */
  body { font-family: 'Pretendard', 'Malgun Gothic', sans-serif; background-color: #f0f2f5; display: flex; justify-content: center; padding: 20px; margin: 0; }
  .container { width: 100%; max-width: 600px; background: white; padding: 25px; border-radius: 15px; box-shadow: 0 4px 20px rgba(0,0,0,0.08); }
  input, button, textarea { font-family: inherit; box-sizing: border-box; }

  /* --- ìº˜ë¦°ë” í—¤ë” & ê·¸ë¦¬ë“œ --- */
  .calendar-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
  .calendar-header h2 { margin: 0; color: #333; font-size: 1.2rem; }
  .nav-btn { background: none; border: 1px solid #ddd; border-radius: 5px; padding: 5px 10px; cursor: pointer; }
  
  .calendar-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 8px; margin-bottom: 20px;}
  .day-name { text-align: center; font-size: 0.8rem; color: #888; padding-bottom: 5px; }
  
  .day-cell { 
    height: 60px; background: #fafafa; border: 1px solid #eee; border-radius: 8px; 
    position: relative; cursor: pointer; transition: 0.2s; padding: 5px;
    display: flex; flex-direction: column; justify-content: space-between;
  }
  .day-cell:hover { background: #eef; border-color: #ccd; transform: translateY(-2px); }
  .day-number { font-size: 14px; font-weight: bold; color: #333; }
  
  .has-homework { background-color: #e3f2fd !important; border: 1px solid #90caf9 !important; }
  .hw-badge {
    align-self: flex-end;
    background-color: #ff5252; color: white;
    font-size: 10px; font-weight: bold;
    padding: 2px 6px; border-radius: 10px;
  }

  /* --- 1ë‹¨ê³„: ë‹‰ë„¤ì„ ë¦¬ìŠ¤íŠ¸ --- */
  #nickname-view { display: none; border-top: 2px solid #eee; padding-top: 20px; animation: fadeIn 0.3s; }
  .section-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
  .section-title { font-size: 1rem; color: #555; font-weight: bold; margin: 0; }
  
  .btn-add-show {
    background-color: #333; color: white; border: none; padding: 6px 12px;
    border-radius: 6px; font-size: 12px; cursor: pointer;
  }

  .nick-list { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin-bottom: 20px; }
  .nick-btn {
    background: #fff; border: 2px solid #ddd; border-radius: 10px; padding: 15px 5px;
    font-size: 14px; font-weight: bold; color: #666; cursor: pointer; transition: 0.2s;
    text-align: center; position: relative;
  }
  .nick-btn:hover { transform: scale(1.02); }
  .nick-btn.active { border-color: #333; box-shadow: 0 0 0 2px #ddd; }

  /* ìƒíƒœë³„ ìƒ‰ìƒ */
  .status-todo { border-color: #ddd; color: #666; }
  .status-partial { background-color: #fff8e1; border-color: #ffb74d; color: #f57c00; }
  .status-done { background-color: #e8f5e9; border-color: #81c784; color: #2e7d32; }

  /* --- [ì‹ ê·œ] ìˆ™ì œ ì¶”ê°€ í¼ --- */
  #add-form { 
    display: none; background: #fff; border: 2px dashed #bbb; padding: 15px; border-radius: 10px; margin-bottom: 20px; 
    animation: slideUp 0.2s;
  }
  .form-row { display: flex; gap: 10px; margin-bottom: 10px; }
  .form-group { flex: 1; }
  .form-label { font-size: 12px; color: #777; margin-bottom: 4px; display: block; }
  .form-input { 
    width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 6px; font-size: 14px; 
  }
  .form-input:focus { border-color: #00a1ff; outline: none; }
  
  .btn-register {
    width: 100%; background-color: #00a1ff; color: white; border: none; padding: 10px;
    border-radius: 6px; font-weight: bold; cursor: pointer; margin-top: 5px;
  }
  .btn-register:hover { background-color: #008ecc; }

  /* --- 2ë‹¨ê³„: ìƒì„¸ ì •ë³´ ì¹´ë“œ (ê¸°ì¡´ ìœ ì§€) --- */
  #detail-card { display: none; margin-top: 20px; background: #f9f9f9; border-radius: 12px; padding: 20px; border: 1px solid #eee; animation: slideUp 0.3s; }
  
  .card-header { display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid #eee; padding-bottom: 10px; margin-bottom: 15px; }
  .user-info h3 { margin: 0; font-size: 1.1rem; color: #333; }
  .user-id { font-size: 0.85rem; color: #888; }
  
  .stat-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 15px; }
  .stat-box { background: white; padding: 10px; border-radius: 8px; text-align: center; border: 1px solid #eee; }
  .stat-label { font-size: 0.8rem; color: #777; display: block; margin-bottom: 4px; }
  .stat-value { font-size: 1.1rem; font-weight: bold; color: #333; }
  .stat-value.money { color: #00a1ff; } 
  .stat-value.reverse { color: #ff5252; } 

  .task-box { background: white; padding: 15px; border-radius: 8px; border: 1px solid #eee; margin-bottom: 15px; }
  .task-label { font-size: 0.9rem; font-weight: bold; margin-bottom: 8px; display: block; color: #555; }
  .task-content { font-size: 1rem; line-height: 1.4; color: #333; margin-bottom: 10px; }

  /* ì§„í–‰ìƒíƒœ ë° ë©”ëª¨ */
  .status-control { margin-top: 15px; border-top: 1px solid #eee; padding-top: 15px; }
  .status-options { display: flex; gap: 5px; margin-bottom: 10px; }
  .status-radio { display: none; }
  .status-label {
    flex: 1; text-align: center; padding: 8px; border-radius: 6px; cursor: pointer;
    font-size: 13px; font-weight: bold; color: #777; background: #eee; border: 1px solid #ddd;
  }
  
  input[type="radio"]:checked + .status-label.lbl-todo { background: #9e9e9e; color: white; border-color: #9e9e9e; }
  input[type="radio"]:checked + .status-label.lbl-partial { background: #ff9800; color: white; border-color: #ff9800; }
  input[type="radio"]:checked + .status-label.lbl-done { background: #4caf50; color: white; border-color: #4caf50; }

  .memo-input {
    width: 100%; box-sizing: border-box; padding: 10px; border: 1px solid #ddd; border-radius: 6px;
    font-size: 14px; resize: vertical; min-height: 60px; margin-bottom: 10px;
  }

  .btn-group { display: flex; gap: 10px; }
  .btn-save { flex: 1; background-color: #333; color: white; border: none; padding: 12px; border-radius: 8px; font-weight: bold; cursor: pointer; }
  .btn-soop {
    flex: 1; background-color: #00a1ff; color: white; border: none; padding: 12px;
    border-radius: 8px; text-decoration: none; font-weight: bold; cursor: pointer; text-align: center; font-size: 14px;
    display: flex; align-items: center; justify-content: center;
  }
  .btn-soop:hover { background-color: #008ecc; }

  @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
  @keyframes slideUp { from { transform: translateY(10px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
</style>
</head>
<body>

<div class="container">
  <div class="calendar-header">
    <button class="nav-btn" onclick="changeMonth(-1)">â—€</button>
    <h2 id="current-month">2026ë…„ 1ì›”</h2>
    <button class="nav-btn" onclick="changeMonth(1)">â–¶</button>
  </div>
  
  <div class="calendar-grid" id="calendar"></div>

  <div id="nickname-view">
    <div class="section-header">
      <h3 class="section-title" id="selected-date-text">ìˆ™ì œ ëŒ€ìƒì</h3>
      <button class="btn-add-show" onclick="toggleAddForm()">+ ìˆ™ì œ ì¶”ê°€í•˜ê¸°</button>
    </div>

    <div id="add-form">
      <div class="form-row">
        <div class="form-group">
          <label class="form-label">ë‹‰ë„¤ì„</label>
          <input type="text" id="new-nick" class="form-input" placeholder="íŒ¬ë‹‰ë„¤ì„">
        </div>
        <div class="form-group">
          <label class="form-label">SOOP ì•„ì´ë””</label>
          <input type="text" id="new-id" class="form-input" placeholder="ì˜ë¬¸ID">
        </div>
      </div>
      <div class="form-row">
        <div class="form-group">
          <label class="form-label">ë‚­í”Œ/ì´í•© ê¸ˆì•¡ (ìˆ«ìë§Œ)</label>
          <input type="number" id="new-amount" class="form-input" placeholder="1000" oninput="autoCalculate()">
        </div>
      </div>
      <div class="form-row">
        <div class="form-group">
          <label class="form-label">ì—­íŒ¬(3%) - ìë™ê³„ì‚°</label>
          <input type="number" id="new-reverse" class="form-input" readonly>
        </div>
      </div>
      <div class="form-group">
        <label class="form-label">ìˆ™ì œ ë‚´ìš© - ìë™ë°°ì •</label>
        <input type="text" id="new-content" class="form-input">
      </div>
      <button class="btn-register" onclick="addNewTask()">ë“±ë¡ ì™„ë£Œ</button>
    </div>

    <div class="nick-list" id="nick-list-container"></div>
  </div>

  <div id="detail-card">
    <div class="card-header">
      <div class="user-info">
        <h3 id="detail-nick">ë‹‰ë„¤ì„</h3>
        <span class="user-id" id="detail-id">id_placeholder</span>
      </div>
      <button class="nav-btn" onclick="closeDetail()">X</button>
    </div>

    <div class="stat-grid">
      <div class="stat-box">
        <span class="stat-label">ì´ í›„ì›</span>
        <span class="stat-value money" id="detail-amount">0</span>
      </div>
      <div class="stat-box">
        <span class="stat-label">ì—­íŒ¬(3%)</span>
        <span class="stat-value reverse" id="detail-reverse">0</span>
      </div>
    </div>

    <div class="task-box">
      <span class="task-label">ğŸ“ ìˆ™ì œ ë‚´ìš©</span>
      <div class="task-content" id="detail-content">ë‚´ìš©</div>
      
      <div class="status-control">
        <span class="task-label">ìƒíƒœ ë° ë©”ëª¨</span>
        <div class="status-options">
          <input type="radio" name="status" id="st-todo" value="todo" class="status-radio">
          <label for="st-todo" class="status-label lbl-todo">ëŒ€ê¸°ì¤‘</label>
          <input type="radio" name="status" id="st-partial" value="partial" class="status-radio">
          <label for="st-partial" class="status-label lbl-partial">ì¼ë¶€ ì™„ë£Œ</label>
          <input type="radio" name="status" id="st-done" value="done" class="status-radio">
          <label for="st-done" class="status-label lbl-done">ì™„ì „ ì™„ë£Œ</label>
        </div>
        <textarea id="detail-memo" class="memo-input" placeholder="ë©”ëª¨ (ì˜ˆ: ì‚¬ì§„ ì „ì†¡ ì™„ë£Œ)"></textarea>
      </div>
    </div>

    <div class="btn-group">
      <button class="btn-save" onclick="saveTaskStatus()">ğŸ’¾ ì €ì¥</button>
      <a href="#" target="_blank" class="btn-soop" id="detail-link">SOOP ë°©ì†¡êµ­ â–¶</a>
    </div>
  </div>

</div>

<script>
  // ë°ì´í„° ì €ì¥ì†Œ
  const homeworkData = {
    "2026-01-20": [
      { nick: "íšŒì¥ë‹˜", id: "ceo123", amount: 10000, reverse: 300, content: "ì •ì„±ë°©ì…€+ì‚¬ì§„4+ì›€ì§¤4", status: "partial", memo: "ì‚¬ì§„ë§Œ ë¨¼ì €" }
    ]
  };

  let currentDate = new Date();
  let selectedDateKey = null;
  let currentTaskIndex = null;

  function renderCalendar() {
    const year = currentDate.getFullYear();
    const month = currentDate.getMonth();
    
    document.getElementById('current-month').innerText = `${year}ë…„ ${month + 1}ì›”`;
    const calendarEl = document.getElementById('calendar');
    calendarEl.innerHTML = '';
    
    // í™”ë©´ ì´ˆê¸°í™”
    document.getElementById('nickname-view').style.display = 'none';
    document.getElementById('detail-card').style.display = 'none';
    document.getElementById('add-form').style.display = 'none'; // í¼ë„ ë‹«ê¸°

    ['ì¼','ì›”','í™”','ìˆ˜','ëª©','ê¸ˆ','í† '].forEach(d => 
      calendarEl.innerHTML += `<div class="day-name">${d}</div>`
    );

    const firstDay = new Date(year, month, 1).getDay();
    const lastDate = new Date(year, month + 1, 0).getDate();

    for(let i=0; i<firstDay; i++) calendarEl.innerHTML += `<div></div>`;

    for(let i=1; i<=lastDate; i++) {
      const dateKey = `${year}-${String(month+1).padStart(2, '0')}-${String(i).padStart(2, '0')}`;
      const tasks = homeworkData[dateKey] || [];
      const hasTask = tasks.length > 0;
      
      calendarEl.innerHTML += `
        <div class="day-cell ${hasTask ? 'has-homework' : ''}" onclick="selectDate('${dateKey}')">
          <div class="day-number">${i}</div>
          ${hasTask ? `<div class="hw-badge">${tasks.length}</div>` : ''}
        </div>
      `;
    }
  }

  function changeMonth(step) {
    currentDate.setMonth(currentDate.getMonth() + step);
    renderCalendar();
  }

  // --- ë‚ ì§œ ì„ íƒ ---
  function selectDate(dateKey) {
    selectedDateKey = dateKey;
    const tasks = homeworkData[dateKey] || []; // ì—†ìœ¼ë©´ ë¹ˆ ë°°ì—´
    
    document.getElementById('detail-card').style.display = 'none';
    document.getElementById('add-form').style.display = 'none'; // ë‚ ì§œ ë°”ê¾¸ë©´ í¼ ë‹«ê¸°
    document.getElementById('selected-date-text').innerText = `${dateKey} ë¦¬ìŠ¤íŠ¸`;
    
    renderNickList(tasks);
    document.getElementById('nickname-view').style.display = 'block';
  }

  // --- ë‹‰ë„¤ì„ ë²„íŠ¼ ë¦¬ìŠ¤íŠ¸ ê·¸ë¦¬ê¸° ---
  function renderNickList(tasks) {
    const nickList = document.getElementById('nick-list-container');
    nickList.innerHTML = '';

    if (tasks.length === 0) {
      nickList.innerHTML = `<div style="grid-column: span 3; text-align:center; color:#999; padding: 10px;">ë“±ë¡ëœ ìˆ™ì œê°€ ì—†ìŠµë‹ˆë‹¤.</div>`;
      return;
    }

    tasks.forEach((task, index) => {
      const btn = document.createElement('button');
      let statusClass = 'status-todo';
      if(task.status === 'partial') statusClass = 'status-partial';
      if(task.status === 'done') statusClass = 'status-done';
      
      btn.className = `nick-btn ${statusClass}`;
      btn.innerText = task.nick;
      
      btn.onclick = () => {
        document.querySelectorAll('.nick-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        showMemberDetail(task, index);
      };
      nickList.appendChild(btn);
    });
  }

  // --- ìˆ™ì œ ì¶”ê°€ í¼ ê´€ë ¨ ê¸°ëŠ¥ ---
  function toggleAddForm() {
    const form = document.getElementById('add-form');
    // í† ê¸€: ì¼œì ¸ìˆìœ¼ë©´ ë„ê³ , êº¼ì ¸ìˆìœ¼ë©´ ì¼¬
    if(form.style.display === 'block') {
      form.style.display = 'none';
    } else {
      // í¼ ì´ˆê¸°í™” í›„ ì—´ê¸°
      document.getElementById('new-nick').value = '';
      document.getElementById('new-id').value = '';
      document.getElementById('new-amount').value = '';
      document.getElementById('new-reverse').value = '';
      document.getElementById('new-content').value = '';
      form.style.display = 'block';
      document.getElementById('new-nick').focus();
    }
  }

  // ìë™ ê³„ì‚° ë¡œì§ (ì²« ë²ˆì§¸ ìš”ì²­í•˜ì‹  ê·œì¹™ ì ìš©)
  function autoCalculate() {
    const amount = parseInt(document.getElementById('new-amount').value) || 0;
    const reverseInput = document.getElementById('new-reverse');
    const contentInput = document.getElementById('new-content');

    // ì—­íŒ¬ 3%
    const reverse = Math.floor(amount * 0.03);
    reverseInput.value = reverse;

    // êµ¬ê°„ë³„ ìˆ™ì œ ìë™ ë°°ì •
    let content = "";
    if (amount < 1000) {
      content = "(ì†ŒìŒë‹¨ - ìˆ™ì œ ì—†ìŒ)";
    } else if (amount < 3000) {
      content = "ê³ ì •ì‚¬ì§„ ë°©ì…€, ì‚¬ì§„ 1+, ì›€ì§¤ 0";
    } else if (amount < 5000) {
      content = "ë°©ì…€, ì‚¬ì§„ 2, ì›€ì§¤ 0";
    } else if (amount < 10000) {
      content = "ë°©ì…€, ì‚¬ì§„ 2, ì›€ì§¤ 1";
    } else {
      content = "ì •ì„±ë°©ì…€, ì‚¬ì§„ 4, ì›€ì§¤ 4";
    }
    contentInput.value = content;
  }

  // ì‹ ê·œ ë“±ë¡ ì‹¤í–‰
  function addNewTask() {
    if(!selectedDateKey) return alert("ë‚ ì§œë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.");
    
    const nick = document.getElementById('new-nick').value;
    const id = document.getElementById('new-id').value;
    const amount = parseInt(document.getElementById('new-amount').value) || 0;
    const reverse = parseInt(document.getElementById('new-reverse').value) || 0;
    const content = document.getElementById('new-content').value;

    if(!nick || !id) return alert("ë‹‰ë„¤ì„ê³¼ ì•„ì´ë””ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.");

    // ë°ì´í„° êµ¬ì¡° ë§Œë“¤ê¸°
    const newTask = {
      nick: nick,
      id: id,
      amount: amount,
      reverse: reverse,
      content: content,
      status: "todo",
      memo: ""
    };

    // ë°°ì—´ì´ ì—†ìœ¼ë©´ ìƒì„±
    if(!homeworkData[selectedDateKey]) {
      homeworkData[selectedDateKey] = [];
    }

    // ì¶”ê°€í•˜ê³  í™”ë©´ ê°±ì‹ 
    homeworkData[selectedDateKey].push(newTask);
    
    // í¼ ë‹«ê¸° ë° ê°±ì‹ 
    document.getElementById('add-form').style.display = 'none';
    renderNickList(homeworkData[selectedDateKey]);
    
    // ìº˜ë¦°ë”ì˜ ë±ƒì§€ ìˆ«ì ì—…ë°ì´íŠ¸ë¥¼ ìœ„í•´ ìº˜ë¦°ë” ë‹¤ì‹œ ê·¸ë¦¬ê¸° (ì„ íƒì )
    renderCalendar();
    // ìº˜ë¦°ë” ë‹¤ì‹œ ê·¸ë¦¬ë©´ ë·°ê°€ ë‹«íˆë¯€ë¡œ ë‹¤ì‹œ ì—´ì–´ì¤Œ
    document.getElementById('nickname-view').style.display = 'block';
  }

  // --- ìƒì„¸ ì •ë³´ í‘œì‹œ ---
  function showMemberDetail(task, index) {
    currentTaskIndex = index;
    const card = document.getElementById('detail-card');
    
    document.getElementById('detail-nick').innerText = task.nick;
    document.getElementById('detail-id').innerText = `@${task.id}`;
    document.getElementById('detail-amount').innerText = task.amount.toLocaleString();
    document.getElementById('detail-reverse').innerText = task.reverse.toLocaleString();
    document.getElementById('detail-content').innerText = task.content;
    document.getElementById('detail-memo').value = task.memo || '';
    
    const status = task.status || 'todo';
    document.querySelector(`input[name="status"][value="${status}"]`).checked = true;

    document.getElementById('detail-link').href = `https://www.sooplive.co.kr/station/${task.id}`;
    
    card.style.display = 'block';
    card.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
  }

  // --- ìƒíƒœ ì €ì¥ ---
  function saveTaskStatus() {
    if (!selectedDateKey || currentTaskIndex === null) return;

    const newMemo = document.getElementById('detail-memo').value;
    const newStatus = document.querySelector('input[name="status"]:checked').value;

    const task = homeworkData[selectedDateKey][currentTaskIndex];
    task.memo = newMemo;
    task.status = newStatus;

    alert('ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.');
    renderNickList(homeworkData[selectedDateKey]);
    
    // ë²„íŠ¼ ìƒíƒœ ì—…ë°ì´íŠ¸ í›„ ë‹¤ì‹œ í´ë¦­ íš¨ê³¼ (ì„ íƒ ìŠ¤íƒ€ì¼ ìœ ì§€)
    const btns = document.querySelectorAll('.nick-btn');
    if(btns[currentTaskIndex]) btns[currentTaskIndex].classList.add('active');
  }

  function closeDetail() {
    document.getElementById('detail-card').style.display = 'none';
    document.querySelectorAll('.nick-btn').forEach(b => b.classList.remove('active'));
    currentTaskIndex = null;
  }

  // ì´ˆê¸° ì‹¤í–‰
  renderCalendar();
</script>

</body>
</html>

<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>C9 ìˆ™ì œ ìº˜ë¦°ë” (ìµœì¢…)</title>
<style>
  /* --- ê³µí†µ ìŠ¤íƒ€ì¼ --- */
  body { 
    font-family: 'Pretendard', 'Malgun Gothic', sans-serif; 
    background-color: #f0f2f5; 
    padding: 20px; margin: 0; 
  }
  input, button, textarea { font-family: inherit; box-sizing: border-box; }

  /* --- ë ˆì´ì•„ì›ƒ --- */
  .wrapper {
    display: flex; gap: 20px; max-width: 1000px; margin: 0 auto;
    align-items: flex-start;
  }

  /* --- ì‚¬ì´ë“œë°” --- */
  .sidebar {
    width: 240px; background: white; padding: 20px; border-radius: 15px;
    box-shadow: 0 4px 20px rgba(0,0,0,0.08); flex-shrink: 0; max-height: 800px; overflow-y: auto;
  }
  .sidebar-title { font-size: 1rem; font-weight: bold; margin: 0 0 15px 0; color: #333; border-bottom: 2px solid #eee; padding-bottom: 10px; }
  
  .shortcut-btn {
    width: 100%; background: #fff; border: 1px solid #eee; padding: 12px;
    border-radius: 8px; margin-bottom: 8px; cursor: pointer; text-align: left;
    transition: 0.2s; display: flex; justify-content: space-between; align-items: center;
  }
  .shortcut-btn:hover { background: #f9f9f9; border-color: #ccc; }
  .shortcut-date { font-weight: bold; color: #555; font-size: 14px; }
  .shortcut-count { background: #00a1ff; color: white; font-size: 11px; padding: 2px 6px; border-radius: 10px; }
  .no-data-msg { font-size: 13px; color: #999; text-align: center; padding: 20px 0; }

  /* --- ë©”ì¸ ì»¨í…Œì´ë„ˆ --- */
  .container { 
    flex: 1; background: white; padding: 25px; border-radius: 15px; 
    box-shadow: 0 4px 20px rgba(0,0,0,0.08); 
  }

  /* ìº˜ë¦°ë” */
  .calendar-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
  .calendar-header h2 { margin: 0; color: #333; font-size: 1.2rem; }
  .nav-btn { background: white; border: 1px solid #ddd; border-radius: 5px; padding: 8px 12px; cursor: pointer; }
  
  .calendar-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 5px; margin-bottom: 20px;}
  .day-name { text-align: center; font-size: 0.8rem; color: #888; padding-bottom: 5px; }
  
  .day-cell { 
    height: 65px; background: #fafafa; border: 1px solid #eee; border-radius: 8px; 
    position: relative; cursor: pointer; transition: 0.2s; padding: 4px;
    display: flex; flex-direction: column; justify-content: space-between;
  }
  .day-cell:hover { background: #eef; border-color: #ccd; transform: translateY(-2px); }
  .day-number { font-size: 13px; font-weight: bold; color: #333; }
  
  .has-homework { background-color: #e3f2fd !important; border: 1px solid #90caf9 !important; }
  .hw-badge {
    align-self: flex-end; background-color: #ff5252; color: white;
    font-size: 10px; font-weight: bold; padding: 2px 5px; border-radius: 8px;
  }

  /* ë¦¬ìŠ¤íŠ¸ ì˜ì—­ */
  #nickname-view { display: none; border-top: 2px solid #eee; padding-top: 20px; animation: fadeIn 0.3s; }
  .section-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
  .section-title { font-size: 1rem; color: #555; font-weight: bold; margin: 0; }
  
  .btn-add-show {
    background-color: #333; color: white; border: none; padding: 8px 14px;
    border-radius: 6px; font-size: 12px; cursor: pointer;
  }

  .nick-list { display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px; margin-bottom: 20px; }
  .nick-btn {
    background: #fff; border: 2px solid #ddd; border-radius: 10px; padding: 12px 4px;
    font-size: 13px; font-weight: bold; color: #666; cursor: pointer; transition: 0.2s;
    text-align: center; overflow: hidden; white-space: nowrap; text-overflow: ellipsis;
  }
  .nick-btn:hover { transform: scale(1.02); }
  .nick-btn.active { border-color: #333; box-shadow: 0 0 0 2px #ddd; }
  
  .status-todo { border-color: #ddd; color: #666; }
  .status-partial { background-color: #fff8e1; border-color: #ffb74d; color: #f57c00; }
  .status-done { background-color: #e8f5e9; border-color: #81c784; color: #2e7d32; }

  /* --- ë“±ë¡ í¼ (ìˆ˜ì •ë¨) --- */
  #add-form { 
    display: none; background: #fff; border: 2px dashed #bbb; padding: 15px; border-radius: 10px; margin-bottom: 20px; 
    animation: slideUp 0.2s;
  }
  .form-row { display: flex; gap: 10px; margin-bottom: 10px; }
  .form-group { flex: 1; }
  .form-label { font-size: 12px; color: #777; margin-bottom: 4px; display: block; }
  .form-input { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 6px; font-size: 14px; }
  
  /* ë¼ë””ì˜¤ ë²„íŠ¼ ê·¸ë£¹ (3%, 10%) */
  .radio-group { display: flex; gap: 15px; margin-bottom: 5px; }
  .radio-label { display: flex; align-items: center; gap: 5px; font-size: 13px; cursor: pointer; font-weight: bold; }
  
  .btn-register { width: 100%; background-color: #00a1ff; color: white; border: none; padding: 12px; border-radius: 6px; font-weight: bold; cursor: pointer; margin-top: 5px; }

  /* ìƒì„¸ ì¹´ë“œ */
  #detail-card { display: none; margin-top: 20px; background: #f9f9f9; border-radius: 12px; padding: 20px; border: 1px solid #eee; animation: slideUp 0.3s; }
  .card-header { display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid #eee; padding-bottom: 10px; margin-bottom: 15px; }
  .user-info h3 { margin: 0; font-size: 1.1rem; color: #333; }
  .user-id { font-size: 0.85rem; color: #888; }
  
  .stat-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 15px; }
  .stat-box { background: white; padding: 10px; border-radius: 8px; text-align: center; border: 1px solid #eee; }
  .stat-label { font-size: 0.8rem; color: #777; display: block; margin-bottom: 4px; }
  .stat-value { font-size: 1.1rem; font-weight: bold; color: #333; }
  .stat-value.money { color: #00a1ff; } 
  .stat-value.reverse { color: #ff5252; } 

  .task-box { background: white; padding: 15px; border-radius: 8px; border: 1px solid #eee; margin-bottom: 15px; }
  .task-label { font-size: 0.9rem; font-weight: bold; margin-bottom: 8px; display: block; color: #555; }
  .task-content { font-size: 1rem; line-height: 1.4; color: #333; margin-bottom: 10px; word-break: keep-all; }

  .status-control { margin-top: 15px; border-top: 1px solid #eee; padding-top: 15px; }
  .status-options { display: flex; gap: 5px; margin-bottom: 10px; }
  .status-radio { display: none; }
  .status-label {
    flex: 1; text-align: center; padding: 10px; border-radius: 6px; cursor: pointer;
    font-size: 13px; font-weight: bold; color: #777; background: #eee; border: 1px solid #ddd;
  }
  input[type="radio"]:checked + .status-label.lbl-todo { background: #9e9e9e; color: white; border-color: #9e9e9e; }
  input[type="radio"]:checked + .status-label.lbl-partial { background: #ff9800; color: white; border-color: #ff9800; }
  input[type="radio"]:checked + .status-label.lbl-done { background: #4caf50; color: white; border-color: #4caf50; }

  .memo-input { width: 100%; box-sizing: border-box; padding: 10px; border: 1px solid #ddd; border-radius: 6px; font-size: 14px; resize: vertical; min-height: 60px; margin-bottom: 10px; }
  
  .btn-group { display: flex; gap: 10px; }
  .btn-save { flex: 1; background-color: #333; color: white; border: none; padding: 12px; border-radius: 8px; font-weight: bold; cursor: pointer; }
  .btn-soop {
    flex: 1; background-color: #00a1ff; color: white; border: none; padding: 12px;
    border-radius: 8px; text-decoration: none; font-weight: bold; cursor: pointer; text-align: center; font-size: 14px; display: flex; align-items: center; justify-content: center;
  }
  .btn-del { margin-top: 10px; width: 100%; background: #fff; border: 1px solid #ff5252; color: #ff5252; padding: 8px; border-radius: 6px; cursor: pointer; font-size: 12px; }

  @media (max-width: 768px) {
    .wrapper { flex-direction: column; }
    .sidebar { width: 100%; box-sizing: border-box; max-height: 200px; }
  }

  @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
  @keyframes slideUp { from { transform: translateY(10px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
</style>
</head>
<body>

<div class="wrapper">
  
  <div class="sidebar">
    <div class="sidebar-title">ğŸ“‚ ìˆ™ì œ ê¸°ë¡</div>
    <div id="sidebar-list">
      </div>
  </div>

  <div class="container">
    <div class="calendar-header">
      <button class="nav-btn" onclick="changeMonth(-1)">â—€</button>
      <h2 id="current-month">2026ë…„ 1ì›”</h2>
      <button class="nav-btn" onclick="changeMonth(1)">â–¶</button>
    </div>
    
    <div class="calendar-grid" id="calendar"></div>

    <div id="nickname-view">
      <div class="section-header">
        <h3 class="section-title" id="selected-date-text">ìˆ™ì œ ëŒ€ìƒì</h3>
        <button class="btn-add-show" onclick="toggleAddForm()">+ ìˆ™ì œ ì¶”ê°€</button>
      </div>

      <div id="add-form">
        <div class="form-row">
          <div class="form-group">
            <label class="form-label">ë‹‰ë„¤ì„</label>
            <input type="text" id="new-nick" class="form-input" placeholder="íŒ¬ë‹‰ë„¤ì„">
          </div>
          <div class="form-group">
            <label class="form-label">SOOP ì•„ì´ë””</label>
            <input type="text" id="new-id" class="form-input" placeholder="ì˜ë¬¸ID">
          </div>
        </div>
        
        <div class="form-row">
          <div class="form-group">
            <label class="form-label">ì´í•© ê¸ˆì•¡</label>
            <input type="number" id="new-amount" class="form-input" placeholder="1000" oninput="autoCalculate()">
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label class="form-label">ì—­íŒ¬ ê³„ì‚° (ë¹„ìœ¨ ì„ íƒ)</label>
            <div class="radio-group">
              <label class="radio-label">
                <input type="radio" name="calc-ratio" value="0.03" checked onchange="autoCalculate()"> 3%
              </label>
              <label class="radio-label">
                <input type="radio" name="calc-ratio" value="0.10" onchange="autoCalculate()"> 10%
              </label>
            </div>
            <input type="number" id="new-reverse" class="form-input" placeholder="ìë™ ê³„ì‚°ë¨" readonly>
          </div>
        </div>

        <div class="form-group">
          <label class="form-label">ìˆ™ì œ ë‚´ìš© (ì§ì ‘ ì…ë ¥)</label>
          <input type="text" id="new-content" class="form-input" placeholder="ì˜ˆ: ì •ì„±ë°©ì…€ + ì›€ì§¤ 1ê°œ">
        </div>
        
        <button class="btn-register" onclick="addNewTask()">ë“±ë¡ ì™„ë£Œ</button>
      </div>

      <div class="nick-list" id="nick-list-container"></div>
    </div>

    <div id="detail-card">
      <div class="card-header">
        <div class="user-info">
          <h3 id="detail-nick">ë‹‰ë„¤ì„</h3>
          <span class="user-id" id="detail-id">id_placeholder</span>
        </div>
        <button class="nav-btn" onclick="closeDetail()">X</button>
      </div>

      <div class="stat-grid">
        <div class="stat-box">
          <span class="stat-label">ì´ í›„ì›</span>
          <span class="stat-value money" id="detail-amount">0</span>
        </div>
        <div class="stat-box">
          <span class="stat-label">ì—­íŒ¬(ê°œìˆ˜)</span>
          <span class="stat-value reverse" id="detail-reverse">0</span>
        </div>
      </div>

      <div class="task-box">
        <span class="task-label">ğŸ“ ìˆ™ì œ ë‚´ìš©</span>
        <div class="task-content" id="detail-content">ë‚´ìš©</div>
        
        <div class="status-control">
          <span class="task-label">ìƒíƒœ ë° ë©”ëª¨</span>
          <div class="status-options">
            <input type="radio" name="status" id="st-todo" value="todo" class="status-radio">
            <label for="st-todo" class="status-label lbl-todo">ëŒ€ê¸°</label>
            <input type="radio" name="status" id="st-partial" value="partial" class="status-radio">
            <label for="st-partial" class="status-label lbl-partial">ì¼ë¶€</label>
            <input type="radio" name="status" id="st-done" value="done" class="status-radio">
            <label for="st-done" class="status-label lbl-done">ì™„ë£Œ</label>
          </div>
          <textarea id="detail-memo" class="memo-input" placeholder="ì§„í–‰ ìƒí™© ë©”ëª¨"></textarea>
        </div>
      </div>

      <div class="btn-group">
        <button class="btn-save" onclick="saveTaskStatus()">ğŸ’¾ ì €ì¥</button>
        <a href="#" target="_blank" class="btn-soop" id="detail-link">SOOP ë°©ì†¡êµ­ â–¶</a>
      </div>
      <button class="btn-del" onclick="deleteTask()">ğŸ—‘ ì´ ìˆ™ì œ ì‚­ì œí•˜ê¸°</button>
    </div>
  </div>
</div>

<script>
  let homeworkData = JSON.parse(localStorage.getItem('hwData_v1')) || {};
  let currentDate = new Date();
  let selectedDateKey = null;
  let currentTaskIndex = null;

  function saveDataToLocal() {
    localStorage.setItem('hwData_v1', JSON.stringify(homeworkData));
  }

  function renderSidebar() {
    const sidebarList = document.getElementById('sidebar-list');
    sidebarList.innerHTML = '';
    const sortedKeys = Object.keys(homeworkData).sort().reverse();
    const validKeys = sortedKeys.filter(key => homeworkData[key] && homeworkData[key].length > 0);

    if (validKeys.length === 0) {
      sidebarList.innerHTML = `<div class="no-data-msg">ì €ì¥ëœ ìˆ™ì œê°€ ì—†ìŠµë‹ˆë‹¤.</div>`;
      return;
    }

    validKeys.forEach(dateKey => {
      const tasks = homeworkData[dateKey];
      const btn = document.createElement('div');
      btn.className = 'shortcut-btn';
      btn.innerHTML = `<span class="shortcut-date">${dateKey}</span><span class="shortcut-count">${tasks.length}ê±´</span>`;
      btn.onclick = () => {
        currentDate = new Date(dateKey);
        renderCalendar();
        selectDate(dateKey);
      };
      sidebarList.appendChild(btn);
    });
  }

  function renderCalendar() {
    const year = currentDate.getFullYear();
    const month = currentDate.getMonth();
    document.getElementById('current-month').innerText = `${year}ë…„ ${month + 1}ì›”`;
    const calendarEl = document.getElementById('calendar');
    calendarEl.innerHTML = '';
    
    document.getElementById('nickname-view').style.display = 'none';
    document.getElementById('detail-card').style.display = 'none';
    document.getElementById('add-form').style.display = 'none';

    ['ì¼','ì›”','í™”','ìˆ˜','ëª©','ê¸ˆ','í† '].forEach(d => calendarEl.innerHTML += `<div class="day-name">${d}</div>`);

    const firstDay = new Date(year, month, 1).getDay();
    const lastDate = new Date(year, month + 1, 0).getDate();

    for(let i=0; i<firstDay; i++) calendarEl.innerHTML += `<div></div>`;

    for(let i=1; i<=lastDate; i++) {
      const dateKey = `${year}-${String(month+1).padStart(2, '0')}-${String(i).padStart(2, '0')}`;
      const tasks = homeworkData[dateKey] || [];
      const hasTask = tasks.length > 0;
      calendarEl.innerHTML += `
        <div class="day-cell ${hasTask ? 'has-homework' : ''}" onclick="selectDate('${dateKey}')">
          <div class="day-number">${i}</div>
          ${hasTask ? `<div class="hw-badge">${tasks.length}ê±´</div>` : ''}
        </div>
      `;
    }
  }

  function changeMonth(step) {
    currentDate.setMonth(currentDate.getMonth() + step);
    renderCalendar();
  }

  function selectDate(dateKey) {
    selectedDateKey = dateKey;
    const tasks = homeworkData[dateKey] || [];
    document.getElementById('detail-card').style.display = 'none';
    document.getElementById('add-form').style.display = 'none';
    document.getElementById('selected-date-text').innerText = `${dateKey} ë¦¬ìŠ¤íŠ¸`;
    renderNickList(tasks);
    document.getElementById('nickname-view').style.display = 'block';
    if(window.innerWidth <= 768) {
      document.getElementById('nickname-view').scrollIntoView({ behavior: 'smooth' });
    }
  }

  function renderNickList(tasks) {
    const nickList = document.getElementById('nick-list-container');
    nickList.innerHTML = '';
    if (tasks.length === 0) {
      nickList.innerHTML = `<div style="grid-column: span 3; text-align:center; color:#999; padding: 10px; font-size:12px;">ìˆ™ì œê°€ ì—†ìŠµë‹ˆë‹¤.</div>`;
      return;
    }
    tasks.forEach((task, index) => {
      const btn = document.createElement('button');
      let statusClass = 'status-todo';
      if(task.status === 'partial') statusClass = 'status-partial';
      if(task.status === 'done') statusClass = 'status-done';
      
      btn.className = `nick-btn ${statusClass}`;
      btn.innerText = task.nick;
      btn.onclick = () => {
        document.querySelectorAll('.nick-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        showMemberDetail(task, index);
      };
      nickList.appendChild(btn);
    });
  }

  function toggleAddForm() {
    const form = document.getElementById('add-form');
    if(form.style.display === 'block') {
      form.style.display = 'none';
    } else {
      document.getElementById('new-nick').value = '';
      document.getElementById('new-id').value = '';
      document.getElementById('new-amount').value = '';
      document.getElementById('new-reverse').value = '';
      document.getElementById('new-content').value = '';
      form.style.display = 'block';
      document.getElementById('new-nick').focus();
    }
  }

  // [ìˆ˜ì •ë¨] ìë™ ê³„ì‚° ë¡œì§ (ìˆ™ì œë‚´ìš© ìë™ì±„ì›€ ì‚­ì œ, ë¹„ìœ¨ ì„ íƒ ì ìš©)
  function autoCalculate() {
    const amount = parseInt(document.getElementById('new-amount').value) || 0;
    const reverseInput = document.getElementById('new-reverse');
    
    // ì„ íƒëœ ë¼ë””ì˜¤ ë²„íŠ¼ì˜ ë¹„ìœ¨ ê°’ ê°€ì ¸ì˜¤ê¸° (0.03 ë˜ëŠ” 0.10)
    const ratio = parseFloat(document.querySelector('input[name="calc-ratio"]:checked').value);

    // ì—­íŒ¬ ê³„ì‚°
    const reverse = Math.floor(amount * ratio);
    reverseInput.value = reverse;

    // ìˆ™ì œ ë‚´ìš© ìë™ ë°°ì • ë¡œì§ì€ ì‚­ì œë¨ (ì§ì ‘ ì…ë ¥)
  }

  function addNewTask() {
    if(!selectedDateKey) return alert("ë‚ ì§œë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.");
    
    const nick = document.getElementById('new-nick').value;
    const id = document.getElementById('new-id').value;
    const amount = parseInt(document.getElementById('new-amount').value) || 0;
    const reverse = parseInt(document.getElementById('new-reverse').value) || 0;
    const content = document.getElementById('new-content').value;

    if(!nick || !id) return alert("ë‹‰ë„¤ì„ê³¼ ì•„ì´ë””ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.");

    const newTask = {
      nick: nick,
      id: id,
      amount: amount,
      reverse: reverse,
      content: content,
      status: "todo",
      memo: ""
    };

    if(!homeworkData[selectedDateKey]) {
      homeworkData[selectedDateKey] = [];
    }

    homeworkData[selectedDateKey].push(newTask);
    saveDataToLocal();

    document.getElementById('add-form').style.display = 'none';
    renderNickList(homeworkData[selectedDateKey]);
    renderCalendar();
    renderSidebar();
    document.getElementById('nickname-view').style.display = 'block';
  }

  function showMemberDetail(task, index) {
    currentTaskIndex = index;
    const card = document.getElementById('detail-card');
    
    document.getElementById('detail-nick').innerText = task.nick;
    document.getElementById('detail-id').innerText = `@${task.id}`;
    document.getElementById('detail-amount').innerText = task.amount.toLocaleString();
    document.getElementById('detail-reverse').innerText = task.reverse.toLocaleString();
    document.getElementById('detail-content').innerText = task.content; // ì…ë ¥í•œ ë‚´ìš© ê·¸ëŒ€ë¡œ í‘œì‹œ
    document.getElementById('detail-memo').value = task.memo || '';
    
    const status = task.status || 'todo';
    document.querySelector(`input[name="status"][value="${status}"]`).checked = true;

    document.getElementById('detail-link').href = `https://www.sooplive.co.kr/station/${task.id}`;
    
    card.style.display = 'block';
    card.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
  }

  function saveTaskStatus() {
    if (!selectedDateKey || currentTaskIndex === null) return;
    const newMemo = document.getElementById('detail-memo').value;
    const newStatus = document.querySelector('input[name="status"]:checked').value;
    const task = homeworkData[selectedDateKey][currentTaskIndex];
    task.memo = newMemo;
    task.status = newStatus;

    saveDataToLocal();
    alert('ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.');
    renderNickList(homeworkData[selectedDateKey]);
    const btns = document.querySelectorAll('.nick-btn');
    if(btns[currentTaskIndex]) btns[currentTaskIndex].classList.add('active');
  }

  function deleteTask() {
      if (!confirm('ì •ë§ ì´ ìˆ™ì œë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
      homeworkData[selectedDateKey].splice(currentTaskIndex, 1);
      saveDataToLocal();
      closeDetail();
      renderNickList(homeworkData[selectedDateKey]);
      renderCalendar();
      renderSidebar();
      document.getElementById('nickname-view').style.display = 'block';
  }

  function closeDetail() {
    document.getElementById('detail-card').style.display = 'none';
    document.querySelectorAll('.nick-btn').forEach(b => b.classList.remove('active'));
    currentTaskIndex = null;
  }

  renderCalendar();
  renderSidebar();
</script>

</body>
</html>

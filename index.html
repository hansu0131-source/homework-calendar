<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>C9 í† ë¼ ìˆ™ì œ & ë‚­í”Œë‹¨ ê´€ë¦¬ ğŸ°</title>
<style>
  /* --- ğŸ° íŒŒìŠ¤í…” í•‘í¬ í…Œë§ˆ --- */
  :root {
    --bg-color: #fff0f5; 
    --container-bg: #ffffff;
    --primary-pink: #ffb6c1; 
    --dark-pink: #d81b60; 
    --light-pink-hover: #fff5f8;
    --border-pink: #ffe4e1; 
    --text-gray: #555;
    --text-dark: #2c2c2c; 
    --accent-blue: #aed9e0; 
    --radius-soft: 15px;
    --radius-round: 25px;

    /* ê¸°ë¡ì‹¤ ë°°ê²½ìƒ‰ ë‹¨ê³„ */
    --lv0: #FFFFFF; --lv1: #FFF9FD; --lv2: #FFF3FA; --lv3: #FFE9F4; --lv4: #FFE0EF;
    --lv5: #FFD7EB; --lv6: #FFCEE7; --lv7: #FFB3CC; --lv8: #FFA3C2; --lv9: #FF94B8;
  }

  body { 
    font-family: 'Pretendard', 'Malgun Gothic', sans-serif; 
    background-color: var(--bg-color);
    padding: 20px; margin: 0; color: var(--text-dark);
  }
  input, button, textarea, select { font-family: inherit; box-sizing: border-box; outline: none; }
  h2, h3 { color: var(--text-dark); font-weight: 800; }

  /* ë©”ì¸ íƒ­ */
  .main-nav { display: flex; justify-content: center; gap: 15px; margin-bottom: 25px; }
  .nav-tab {
    padding: 12px 30px; border-radius: 30px; font-weight: bold; font-size: 16px;
    background: white; border: 3px solid var(--border-pink); color: var(--text-gray);
    cursor: pointer; transition: 0.2s; box-shadow: 0 4px 10px rgba(255, 182, 193, 0.2);
  }
  .nav-tab:hover { transform: translateY(-3px); }
  .nav-tab.active { background: var(--dark-pink); color: white; border-color: var(--dark-pink); }

  .page-section { display: none; animation: fadeIn 0.3s; }
  .page-section.active { display: block; }

  /* ==========================================================================
     [í˜ì´ì§€ 1] ìº˜ë¦°ë” ìŠ¤íƒ€ì¼ (ê¸°ì¡´ ìœ ì§€)
     ========================================================================== */
  .wrapper { display: flex; gap: 20px; max-width: 1400px; margin: 0 auto; align-items: flex-start; }
  .sidebar, .sidebar-right { 
    width: 260px; background: var(--container-bg); padding: 25px; border-radius: var(--radius-round); 
    box-shadow: 0 8px 25px rgba(255, 182, 193, 0.2); flex-shrink: 0; max-height: 800px; overflow-y: auto; border: 2px solid #fff; 
  }
  .container { 
    flex: 1; background: var(--container-bg); padding: 30px; border-radius: var(--radius-round); 
    box-shadow: 0 8px 25px rgba(255, 182, 193, 0.2); border: 2px solid #fff; position: relative; 
  }

  .calendar-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px; }
  .calendar-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 8px; margin-bottom: 25px;}
  .day-name { text-align: center; font-size: 0.9rem; color: var(--dark-pink); font-weight: bold; padding-bottom: 10px; }
  .day-cell { 
    height: 70px; background: #fff; border: 2px solid var(--border-pink); border-radius: var(--radius-soft); 
    position: relative; cursor: pointer; transition: all 0.2s ease; padding: 6px; display: flex; flex-direction: column; justify-content: space-between; 
  }
  .day-cell:hover { border-color: var(--dark-pink); background: var(--light-pink-hover); transform: scale(1.03); z-index: 1;}
  .day-number { font-size: 14px; font-weight: bold; color: var(--text-gray); }
  .has-homework { background-color: #fff0f3 !important; border: 2px solid var(--primary-pink) !important; }
  .hw-badge { align-self: flex-end; background-color: var(--dark-pink); color: white; font-size: 11px; font-weight: bold; padding: 3px 7px; border-radius: 10px; }

  .shortcut-btn { 
    width: 100%; background: #fff; border: 2px solid var(--border-pink); padding: 12px 15px; 
    border-radius: var(--radius-soft); margin-bottom: 10px; cursor: pointer; display: flex; justify-content: space-between; align-items: center; 
  }
  .shortcut-btn:hover { background: var(--light-pink-hover); border-color: var(--primary-pink); }
  .shortcut-date { font-weight: bold; font-size: 14px; }
  .shortcut-count { background: var(--dark-pink); color: white; padding: 2px 8px; border-radius: 10px; font-size: 12px; }

  .nick-list { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin-bottom: 25px; }
  .nick-btn { 
    background: #fff; border: 2px solid var(--border-pink); border-radius: var(--radius-soft); padding: 15px 5px; 
    font-size: 14px; font-weight: bold; color: var(--text-gray); cursor: pointer; text-align: center; 
    transition: 0.2s; box-shadow: 0 2px 5px rgba(0,0,0,0.05); white-space: nowrap; overflow: hidden; text-overflow: ellipsis; display: block; width: 100%;
  }
  .nick-btn:hover { transform: translateY(-3px); }
  .nick-btn.active { border-color: var(--dark-pink); box-shadow: 0 0 0 2px var(--dark-pink) inset; color: var(--dark-pink);}
  .nick-btn.status-todo { background: #ffebee; color: #d32f2f; border-color: #ffcdd2; }
  .nick-btn.status-partial { background: #fff3e0; color: #f57c00; border-color: #ffe0b2; }
  .nick-btn.status-done { background: #e8f5e9; color: #388e3c; border-color: #c8e6c9; }

  #add-form { display: none; background: #fff5f8; border: 3px dashed var(--primary-pink); padding: 20px; border-radius: var(--radius-round); margin-bottom: 25px; }
  .form-row { display: flex; gap: 15px; margin-bottom: 15px; }
  .form-input { width: 100%; padding: 12px; border: 2px solid var(--border-pink); border-radius: var(--radius-soft); font-size: 14px; background: #fff; }
  .btn-register { width: 100%; background-color: var(--dark-pink); color: white; border: none; padding: 15px; border-radius: var(--radius-soft); font-weight: bold; cursor: pointer; }
  .btn-register.edit-mode { background-color: #aed9e0; }
  .btn-add-show { background-color: var(--dark-pink); color: white; border: none; padding: 8px 16px; border-radius: var(--radius-soft); cursor: pointer; font-weight: bold; }

  #detail-card { display: none; margin-top: 25px; background: #fff9fb; border-radius: var(--radius-round); padding: 25px; border: 3px solid var(--border-pink); box-shadow: 0 10px 25px rgba(255,182,193,0.15); }
  .card-header { display: flex; justify-content: space-between; align-items: flex-start; border-bottom: 3px dotted var(--border-pink); padding-bottom: 15px; margin-bottom: 20px; }
  .user-info h3 { margin: 0; font-size: 1.4rem; color: var(--text-dark); font-weight: 800; margin-bottom: 5px; }
  .user-id { font-size: 0.95rem; color: #888; display: block; }
  .card-actions { display: flex; gap: 8px; }
  .icon-btn { width: 32px; height: 32px; border-radius: 8px; border: 1px solid #ddd; background: white; cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: 16px; transition: 0.2s; }
  .icon-btn:hover { background: #f0f0f0; transform: translateY(-2px); }
  .icon-btn.edit { color: #2196f3; border-color: #bbdefb; }
  .icon-btn.del { color: #f44336; border-color: #ffcdd2; }
  .icon-btn.close { color: #757575; border-color: #e0e0e0; }

  .stat-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 20px; }
  .stat-box { background: white; padding: 15px; border-radius: var(--radius-soft); text-align: center; border: 2px solid var(--border-pink); box-shadow: 0 4px 10px rgba(0,0,0,0.03); }
  .stat-label { font-size: 0.85rem; color: var(--text-gray); display: block; margin-bottom: 5px; }
  .stat-value { font-size: 1.3rem; font-weight: 900; color: var(--text-dark); }
  .task-box { background: white; padding: 20px; border-radius: var(--radius-soft); border: 2px solid var(--border-pink); margin-bottom: 20px; box-shadow: 0 4px 10px rgba(0,0,0,0.03); }
  .task-label { font-size: 0.95rem; font-weight: bold; margin-bottom: 10px; display: block; color: var(--text-dark); }
  .task-content { font-size: 1.1rem; line-height: 1.6; color: var(--text-dark); margin-bottom: 15px; word-break: keep-all; background: var(--light-pink-hover); padding: 15px; border-radius: 10px; }

  .status-control { margin-top: 20px; border-top: 3px dotted var(--border-pink); padding-top: 20px; }
  .status-options { display: flex; gap: 15px; justify-content: center; margin-bottom: 15px; }
  .status-radio { display: none; }
  .status-label { padding: 8px 16px; border-radius: 20px; cursor: pointer; font-size: 14px; font-weight: bold; color: #777; background: #eee; transition: 0.2s; display: flex; align-items: center; gap: 6px; }
  input[type="radio"]:checked + .status-label.lbl-todo { background: #ff8a80; color: white; box-shadow: 0 4px 10px rgba(255, 138, 128, 0.4); }
  input[type="radio"]:checked + .status-label.lbl-partial { background: #ffb74d; color: white; box-shadow: 0 4px 10px rgba(255, 183, 77, 0.4); }
  input[type="radio"]:checked + .status-label.lbl-done { background: #81c784; color: white; box-shadow: 0 4px 10px rgba(129, 199, 132, 0.4); }
  .memo-input { width: 100%; box-sizing: border-box; padding: 15px; border: 2px solid var(--border-pink); border-radius: var(--radius-soft); font-size: 14px; resize: vertical; min-height: 70px; margin-bottom: 10px; background: #fff; transition: 0.2s; }
  
  .btn-soop { display: flex; justify-content: center; align-items: center; gap: 8px; width: 100%; box-sizing: border-box; background-color: var(--accent-blue); color: white; border: none; padding: 15px; border-radius: var(--radius-soft); text-decoration: none; font-weight: bold; font-size: 15px; box-shadow: 0 4px 10px rgba(174, 217, 224, 0.4); margin-bottom: 10px; transition: 0.2s; }
  .btn-soop:hover { background-color: #9ad0d8; transform: translateY(-2px); }
  .soop-icon { width: 20px; height: 20px; fill: white; }
  .btn-complete { width: 100%; box-sizing: border-box; background: var(--dark-pink); border: none; color: white; padding: 15px; border-radius: var(--radius-soft); cursor: pointer; font-size: 15px; font-weight: bold; box-shadow: 0 4px 10px rgba(255, 141, 161, 0.4); transition: 0.2s; }
  
  .nav-btn { background: white; border: 2px solid var(--border-pink); border-radius: 12px; padding: 8px 14px; cursor: pointer; color: var(--primary-pink); font-weight: bold; transition: 0.2s; }
  .nav-btn:hover { background: var(--primary-pink); color: white; border-color: var(--primary-pink); }

  .rank-item { display: flex; align-items: center; justify-content: space-between; background: #fff; border-bottom: 1px dashed var(--border-pink); padding: 12px 5px; margin-bottom: 5px; }
  .rank-info { display: flex; flex-direction: column; }
  .rank-nick { font-weight: bold; color: var(--text-dark); font-size: 14px; }
  .rank-id { font-size: 11px; color: var(--primary-pink); }
  .rank-badge { background: var(--accent-blue); color: white; font-weight: bold; border-radius: 12px; padding: 5px 10px; font-size: 13px; }

  /* ==========================================================================
     [í˜ì´ì§€ 2] ë‚­í”Œë‹¨ ê¸°ë¡ì‹¤ (ìš”ì²­í•˜ì‹  ë””ìì¸ ì ìš©)
     ========================================================================== */
  .season-layout { max-width: 1400px; margin: 0 auto; background: var(--container-bg); border-radius: var(--radius-round); padding: 30px; box-shadow: 0 8px 25px rgba(255, 182, 193, 0.2); border: 2px solid #fff; }
  
  /* ìƒë‹¨ í—¤ë” ì˜ì—­ (íƒ€ì´í‹€, ê³µì§€, ê²€ìƒ‰) */
  .record-header-area { text-align: center; margin-bottom: 20px; }
  .record-header-area h2 { margin: 0 0 10px 0; font-size: 1.5rem; display: flex; align-items: center; justify-content: center; gap: 8px;}
  .notice-text { font-size: 13px; color: #555; margin-bottom: 15px; }
  .search-container input { padding: 8px 15px; width: 300px; border: 1px solid #ddd; border-radius: 20px; background: #f9f9f9; text-align: center; }
  
  .season-tabs { display: flex; gap: 10px; overflow-x: auto; padding-bottom: 10px; margin-bottom: 15px; border-bottom: 2px dashed var(--border-pink); }
  .season-tab-btn { white-space: nowrap; padding: 8px 16px; border-radius: 20px; border: 2px solid var(--border-pink); background: #fff; font-weight: bold; color: var(--text-gray); cursor: pointer; transition: 0.2s; font-size: 13px; }
  .season-tab-btn.active { background: var(--dark-pink); color: white; border-color: var(--dark-pink); }
  
  .controls-row { display: flex; justify-content: flex-end; margin-bottom: 10px; gap: 10px; }
  .paste-guide { font-size: 11px; color: #888; background: #fff; padding: 4px 10px; border-radius: 8px; border: 1px solid #eee; }
  .btn-del-season { font-size: 11px; color: #ff5252; border: 1px solid #ff5252; background: none; border-radius: 6px; padding: 4px 8px; cursor: pointer; }

  /* í…Œì´ë¸” ìŠ¤íƒ€ì¼ */
  .table-scroll { overflow-x: auto; padding-bottom: 10px; }
  .table { display: flex; flex-direction: column; gap: 2px; min-width: 1100px; }
  
  .record-row {
    display: flex; background: white; border-radius: 0; overflow: hidden; /* ë‘¥ê·¼ëª¨ì„œë¦¬ ì œê±° */
    border-bottom: 1px solid #eee; padding: 2px 0;
    transition: 0.1s; align-items: center;
  }
  .record-row:hover { background: #fdfdfd; }
  
  /* í—¤ë” í–‰ */
  .header-row { background: #FFEFF7; border-radius: 10px 10px 0 0; margin-bottom: 0; padding: 8px 0; border: none;}
  .header-row .record-cell { font-weight: 800; color: #d81b60; border: none; font-size: 13px; }

  /* ë°ì´í„° í–‰ */
  .record-row.data-row { border-radius: 5px; margin-bottom: 2px; }

  /* í•©ê³„ í–‰ (í‘¸í„°) */
  .summary-row { 
    background: #FFF0F5; font-weight: 800; color: #d81b60; margin-top: 5px; 
    border-top: 2px solid #FFC2D6; padding: 8px 0; border-radius: 0 0 10px 10px;
  }

  /* ì…€ ê³µí†µ */
  .record-cell {
    padding: 6px 4px; font-size: 13px; text-align: center;
    border-right: 1px solid rgba(0,0,0,0.03); outline: none; 
    white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
    display: flex; justify-content: center; align-items: center; min-height: 24px;
    color: var(--text-dark);
  }
  .record-cell:last-child { border-right: none; }
  .record-cell[contenteditable="true"]:focus { background: #fff; box-shadow: inset 0 0 0 2px var(--dark-pink); }

  /* ğŸ”¥ ì—´ ë„ˆë¹„ ì„¤ì • (ìŠ¤í¬ë¦°ìƒ· ë¹„ìœ¨ ì°¸ê³ ) */
  .col-id { width: 10%; }
  .col-nick { width: 12%; }
  .col-amt { width: 10%; font-weight: bold; color: #d81b60; }
  .col-one { width: 10%; font-weight: bold; color: #d81b60; } /* ì›í”Œì› */
  .col-promise { width: 35%; } 
  .col-reverse { width: 10%; font-weight: bold; color: #d81b60; } /* ì—­íŒ¬ */
  .col-note { width: 8%; color: #888; font-size: 12px; }
  .col-action { width: 5%; }

  /* ê´€ë¦¬ ë²„íŠ¼ (í˜¸ë²„ì‹œ ë“±ì¥) */
  .action-buttons { display: none; gap: 2px; }
  .record-row:hover .action-buttons { display: flex; }
  .mini-btn { background: #FFD8EA; border: none; border-radius: 4px; padding: 2px 6px; font-size: 10px; cursor: pointer; color: #D24E78; }
  .mini-btn:hover { background: #ffbddc; }

  #loading-overlay { position: fixed; top:0; left:0; width:100%; height:100%; background:rgba(255,255,255,0.9); display: flex; justify-content: center; align-items: center; z-index: 9999; font-weight: bold; color: var(--dark-pink); font-size: 1.5rem;}
  .no-data-msg { font-size: 14px; color: #aaa; text-align: center; padding: 50px 0; }

  @media (max-width: 1024px) {
    .wrapper { flex-direction: column; }
    .sidebar, .sidebar-right { width: 100%; max-height: 200px; }
    .table { min-width: 900px; }
  }
  @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
</style>
</head>
<body>

<div id="loading-overlay">ğŸ° ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>

<nav class="main-nav">
  <button id="tab-btn-calendar" class="nav-tab active" onclick="switchPage('calendar')">ğŸ“… ìˆ™ì œ ìº˜ë¦°ë”</button>
  <button id="tab-btn-record" class="nav-tab" onclick="switchPage('record')">ğŸ† ë‚­í”Œë‹¨ ê¸°ë¡ì‹¤</button>
</nav>

<div id="page-calendar" class="page-section active">
  <div class="wrapper">
    <div class="sidebar">
      <div class="sidebar-title">ğŸ° ë‚ ì§œë³„ ê¸°ë¡</div>
      <div id="sidebar-list"></div>
    </div>

    <div class="container">
      <div class="calendar-header">
        <button class="nav-btn" onclick="changeMonth(-1)">â—€ ì´ì „</button>
        <h2 id="current-month" style="margin:0;">2026ë…„ 1ì›”</h2>
        <button class="nav-btn" onclick="changeMonth(1)">ë‹¤ìŒ â–¶</button>
      </div>
      <div class="calendar-grid" id="calendar"></div>

      <div id="nickname-view" style="display:none; margin-top:20px; border-top:3px dotted var(--border-pink); padding-top:20px;">
        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px;">
          <h3 id="selected-date-text" style="margin:0; font-size:18px;">ìˆ™ì œ ëŒ€ìƒì</h3>
          <button class="btn-add-show" onclick="toggleAddForm()">+ ìˆ™ì œ ì¶”ê°€</button>
        </div>
        <div id="add-form">
          <div class="form-row">
            <input type="date" id="new-date" class="form-input">
          </div>
          <div class="form-row">
            <input type="text" id="new-nick" class="form-input" placeholder="ë‹‰ë„¤ì„">
            <input type="text" id="new-id" class="form-input" placeholder="ì•„ì´ë””">
          </div>
          <div class="form-row">
            <input type="number" id="new-amount" class="form-input" placeholder="í’ì„  ê°œìˆ˜" oninput="autoCalculate()">
            <input type="number" id="new-reverse" class="form-input" placeholder="ì—­íŒ¬(ìë™)" readonly>
          </div>
          <div style="margin-bottom:10px; display:flex; gap:10px; align-items:center;">
             <label style="cursor:pointer;"><input type="radio" name="calc-ratio" value="0.03" checked onchange="autoCalculate()"> 3%</label>
             <label style="cursor:pointer;"><input type="radio" name="calc-ratio" value="0.10" onchange="autoCalculate()"> 10%</label>
          </div>
          <input type="text" id="new-content" class="form-input" placeholder="ìˆ™ì œ ë‚´ìš© (ì§ì ‘ ì…ë ¥)" style="margin-bottom:10px;">
          <button class="btn-register" id="btn-submit" onclick="handleTaskSubmit()">ë“±ë¡ ì™„ë£Œ ğŸ’–</button>
        </div>
        <div class="nick-list" id="nick-list-container"></div>
      </div>

      <div id="detail-card">
        <div class="card-header">
          <div class="user-info">
            <h3 id="detail-nick">ë‹‰ë„¤ì„</h3>
            <span class="user-id" id="detail-id">id_placeholder</span>
          </div>
          <div class="card-actions">
            <button class="icon-btn edit" onclick="openEditForm()" title="ìˆ˜ì •">âœï¸</button>
            <button class="icon-btn del" onclick="deleteTask()" title="ì‚­ì œ">ğŸ—‘</button>
            <button class="icon-btn close" onclick="closeDetail()">X</button>
          </div>
        </div>
        <div class="stat-grid">
          <div class="stat-box">
            <span class="stat-label">ì´ í›„ì›</span>
            <span class="stat-value money" id="detail-amount">0</span>
          </div>
          <div class="stat-box">
            <span class="stat-label">ì—­íŒ¬</span>
            <span class="stat-value reverse" id="detail-reverse">0</span>
          </div>
        </div>
        <div class="task-box">
          <span class="task-label">ğŸ“ ìˆ™ì œ ë‚´ìš©</span>
          <div class="task-content" id="detail-content">ë‚´ìš©</div>
          <div class="status-control">
            <div class="status-options">
              <input type="radio" name="status" id="st-todo" value="todo" onchange="saveTaskStatus(false)">
              <label for="st-todo" class="status-label lbl-todo">ğŸ”´ ëŒ€ê¸°</label>
              <input type="radio" name="status" id="st-partial" value="partial" onchange="saveTaskStatus(false)">
              <label for="st-partial" class="status-label lbl-partial">ğŸŸ  ë°©ì…€ë§Œ</label>
              <input type="radio" name="status" id="st-done" value="done" onchange="saveTaskStatus(false)">
              <label for="st-done" class="status-label lbl-done">ğŸŸ¢ ì™„ë£Œ</label>
            </div>
            <textarea id="detail-memo" class="memo-input" placeholder="ë©”ëª¨ë¥¼ ì…ë ¥í•˜ì„¸ìš” (ì…ë ¥ í›„ ë°–ì„ í´ë¦­í•˜ë©´ ìë™ ì €ì¥)" onblur="saveTaskStatus(false)"></textarea>
          </div>
        </div>
        <a href="#" target="_blank" class="btn-soop" id="detail-link">
          <svg class="soop-icon" viewBox="0 0 24 24"><path d="M21 3H3C1.89543 3 1 3.89543 1 5V17C1 18.1046 1.89543 19 3 19H8V21H16V19H21C22.1046 19 23 18.1046 23 17V5C23 3.89543 22.1046 3 21 3ZM21 17H3V5H21V17Z" /></svg>
          SOOP ë°©ì†¡êµ­ ë°”ë¡œê°€ê¸°
        </a>
        <button class="btn-complete" onclick="completeAndDelete()">ì™„ë£Œ ì²˜ë¦¬ (ì‚­ì œ)</button>
      </div>
    </div>

    <div class="sidebar-right">
      <div class="sidebar-title">ğŸ¥• ëˆ„ì  ìˆ™ì œ ë­í‚¹</div>
      <div id="total-rank-list"></div>
    </div>
  </div>
</div>

<div id="page-record" class="page-section">
  <div class="season-layout">
    
    <div class="record-header-area">
      <h2 id="current-season-title">ğŸ° C9 ì‹œì¦Œ2 Â· 3íšŒì°¨ ë‚­í”Œë‹¨</h2>
      <div class="notice-text">ëª¨ë“  ê³µì•½ì€ ìš”ì²­ì‹œì— ê°€ê³ ìˆìŠµë‹ˆë‹¤. ë‹¹êµ°+(hansu0131)ì—ê²Œ ìª½ì§€ ë˜ëŠ” ëŒ“ê¸€ë¡œ í¸í•˜ê²Œ ë§ì”€í•´ì£¼ì„¸ìš” â¤</div>
      <div class="search-container">
        <input type="text" id="record-search" placeholder="ì•„ì´ë”” / ë‹‰ë„¤ì„ ê²€ìƒ‰" oninput="filterRecords()">
      </div>
    </div>

    <div class="season-tabs" id="season-tabs-container"></div>

    <div id="season-content-area" style="display:none;">
      <div class="controls-row">
        <button class="nav-tab" style="font-size:12px; padding:6px 12px;" onclick="createNewSeason()">+ ìƒˆ ì‹œì¦Œ ì¶”ê°€</button>
        <span class="paste-guide">ğŸ’¡ ì—‘ì…€ ë³µì‚¬(Ctrl+C) â†’ ë¶™ì—¬ë„£ê¸°(Ctrl+V)</span>
        <button class="btn-del-season" onclick="deleteCurrentSeason()">ì´ ì‹œì¦Œ ì‚­ì œ</button>
      </div>

      <div class="table-scroll">
        <div class="table" id="record-table-body">
          <div class="record-row header-row">
            <div class="record-cell col-id">ì•„ì´ë””</div>
            <div class="record-cell col-nick">ë‹‰ë„¤ì„</div>
            <div class="record-cell col-amt">ë‚­í”Œ</div>
            <div class="record-cell col-one">ì›í”Œì›</div>
            <div class="record-cell col-promise">ê³µì•½</div>
            <div class="record-cell col-reverse">ì—­íŒ¬</div>
            <div class="record-cell col-note">ë¹„ê³ </div>
            <div class="record-cell col-action"></div>
          </div>

          <div id="record-data-rows"></div>

          <div class="record-row summary-row">
            <div class="record-cell col-id">í•©ê³„</div>
            <div class="record-cell col-nick" id="sum-count" style="color:var(--dark-pink);">0ëª…</div>
            <div class="record-cell col-amt" id="sum-nang">0</div>
            <div class="record-cell col-one" id="sum-one">0</div>
            <div class="record-cell col-promise" id="sum-total" style="font-weight:900; color:#d81b60;">0</div>
            <div class="record-cell col-reverse" id="sum-reverse">0</div>
            <div class="record-cell col-note"></div>
            <div class="record-cell col-action"></div>
          </div>
        </div>
      </div>
      
      <div style="text-align:center; margin-top:20px;">
        <button class="nav-tab" onclick="addEmptyRowAtEnd()">+ ë¹ˆ ì¤„ ì¶”ê°€</button>
      </div>
    </div>

    <div id="no-season-msg" class="no-data-msg">
      ë“±ë¡ëœ íšŒì°¨ê°€ ì—†ìŠµë‹ˆë‹¤. 'ìƒˆ ì‹œì¦Œ ì¶”ê°€' ë²„íŠ¼ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”!
    </div>
  </div>
</div>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
  import { getDatabase, ref, set, onValue } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

  const firebaseConfig = {
    apiKey: "AIzaSyBhduAPQ_9IyEH1rnr9m9qtumgnIF90RII",
    authDomain: "homework-c9.firebaseapp.com",
    databaseURL: "https://homework-c9-default-rtdb.firebaseio.com",
    projectId: "homework-c9",
    storageBucket: "homework-c9.firebasestorage.app",
    messagingSenderId: "293416059203",
    appId: "1:293416059203:web:e962586275e2bd2b356ff6"
  };

  const app = initializeApp(firebaseConfig);
  const db = getDatabase(app);
  
  const dbRefHome = ref(db, 'homework_data');
  const dbRefSeason = ref(db, 'season_data');

  window.homeworkData = {}; 
  window.seasonData = {};
  window.currentSeasonName = null;

  onValue(dbRefHome, (snapshot) => {
    window.homeworkData = snapshot.val() || {};
    refreshCalendarUI();
    document.getElementById('loading-overlay').style.display = 'none';
  });

  onValue(dbRefSeason, (snapshot) => {
    window.seasonData = snapshot.val() || {};
    renderSeasonTabs();
    if(window.currentSeasonName && window.seasonData[window.currentSeasonName]) {
        renderRecordTable(window.currentSeasonName);
    } else {
        const keys = Object.keys(window.seasonData).sort();
        if(keys.length > 0) switchSeasonTab(keys[0]);
        else {
            document.getElementById('season-content-area').style.display = 'none';
            document.getElementById('no-season-msg').style.display = 'block';
        }
    }
  });

  window.saveHomework = () => set(dbRefHome, window.homeworkData);
  window.saveSeason = () => set(dbRefSeason, window.seasonData);

  window.switchPage = (page) => {
    document.querySelectorAll('.page-section').forEach(e => e.classList.remove('active'));
    document.querySelectorAll('.nav-tab').forEach(e => e.classList.remove('active'));
    document.getElementById(`page-${page}`).classList.add('active');
    
    const btnId = `tab-btn-${page}`;
    const btn = document.getElementById(btnId);
    if(btn) btn.classList.add('active');
  };

  // --- ì‹œì¦Œ ê¸°ë¡ì‹¤ ë¡œì§ ---
  window.createNewSeason = () => {
    const name = prompt("ìƒˆ ì‹œì¦Œ/íšŒì°¨ ì´ë¦„ (ì˜ˆ: 1íšŒì°¨, ê²½ìŸì „)");
    if(!name) return;
    if(window.seasonData[name]) return alert("ì´ë¯¸ ìˆìŠµë‹ˆë‹¤.");
    window.seasonData[name] = [];
    window.saveSeason();
    window.switchSeasonTab(name);
  };

  window.renderSeasonTabs = () => {
    const container = document.getElementById('season-tabs-container');
    container.innerHTML = '';
    const keys = Object.keys(window.seasonData).sort();
    
    if(keys.length === 0) return;
    document.getElementById('no-season-msg').style.display = 'none';

    keys.forEach(key => {
        const btn = document.createElement('button');
        btn.className = `season-tab-btn ${key === window.currentSeasonName ? 'active' : ''}`;
        btn.innerText = key;
        btn.onclick = () => window.switchSeasonTab(key);
        container.appendChild(btn);
    });
  };

  window.switchSeasonTab = (name) => {
    window.currentSeasonName = name;
    renderSeasonTabs();
    renderRecordTable(name);
    document.getElementById('season-content-area').style.display = 'block';
  };

  function getLevelColor(amount) {
      const num = parseInt(amount) || 0;
      if(num >= 300000) return 'var(--lv9)';
      if(num >= 100000) return 'var(--lv8)';
      if(num >= 50000) return 'var(--lv7)';
      if(num >= 10000) return 'var(--lv6)';
      if(num >= 5000) return 'var(--lv5)';
      if(num >= 3000) return 'var(--lv4)';
      if(num >= 1000) return 'var(--lv3)';
      if(num >= 299) return 'var(--lv2)';
      if(num >= 100) return 'var(--lv1)';
      return 'var(--lv0)';
  }

  window.renderRecordTable = (seasonName) => {
    document.getElementById('current-season-title').innerText = seasonName;
    const container = document.getElementById('record-data-rows');
    container.innerHTML = '';
    
    const list = window.seasonData[seasonName] || [];
    let count = 0, totalNang = 0, totalOne = 0, totalReverse = 0;

    list.forEach((item, index) => {
        // ë¹ˆ ì¤„ì€ ì¹´ìš´íŠ¸ ì œì™¸
        if(item.id || item.nick) count++;

        const amt = parseInt(item.amount || 0);
        const one = parseInt(item.oneplus || 0);
        const rev = parseInt(item.reverse || 0);
        
        totalNang += amt;
        totalOne += one;
        totalReverse += rev;
        
        const bgColor = getLevelColor(amt);
        const row = document.createElement('div');
        row.className = 'record-row data-row';
        row.style.background = bgColor;
        
        row.innerHTML = `
            <div class="record-cell col-id" contenteditable="true" oninput="handleInput('${seasonName}', ${index}, 'id', this)" onblur="handleBlur()">${item.id || ''}</div>
            <div class="record-cell col-nick" contenteditable="true" oninput="handleInput('${seasonName}', ${index}, 'nick', this)" onblur="handleBlur()">${item.nick || ''}</div>
            <div class="record-cell col-amt amount-cell" contenteditable="true" oninput="handleInput('${seasonName}', ${index}, 'amount', this)" onblur="handleBlur()">${item.amount || ''}</div>
            <div class="record-cell col-one oneplus-cell" contenteditable="true" oninput="handleInput('${seasonName}', ${index}, 'oneplus', this)" onblur="handleBlur()">${item.oneplus || ''}</div>
            <div class="record-cell col-promise" contenteditable="true" oninput="handleInput('${seasonName}', ${index}, 'promise', this)" onblur="handleBlur()">${item.promise || ''}</div>
            <div class="record-cell col-reverse reverse-cell" contenteditable="true" oninput="handleInput('${seasonName}', ${index}, 'reverse', this)" onblur="handleBlur()">${item.reverse || ''}</div>
            <div class="record-cell col-note" contenteditable="true" oninput="handleInput('${seasonName}', ${index}, 'note', this)" onblur="handleBlur()">${item.note || ''}</div>
            <div class="record-cell col-action">
                <div class="action-buttons">
                    <button class="mini-btn" onclick="cloneRow(${index})">+</button>
                    <button class="mini-btn" onclick="removeRow(${index})">ğŸ—‘</button>
                </div>
            </div>
        `;
        container.appendChild(row);
    });

    updateSumDisplay(count, totalNang, totalOne, totalReverse);
  };

  function updateSumDisplay(cnt, nang, one, rev) {
      document.getElementById('sum-count').innerText = `${cnt}ëª…`;
      document.getElementById('sum-nang').innerText = nang.toLocaleString();
      document.getElementById('sum-one').innerText = one.toLocaleString();
      document.getElementById('sum-total').innerText = (nang + one).toLocaleString();
      document.getElementById('sum-reverse').innerText = rev.toLocaleString();
  }

  // ê²€ìƒ‰ í•„í„°
  window.filterRecords = () => {
    const q = document.getElementById('record-search').value.toLowerCase();
    document.querySelectorAll('.data-row').forEach(row => {
        const txt = row.innerText.toLowerCase();
        row.style.display = txt.includes(q) ? 'flex' : 'none';
    });
  };

  window.handleInput = (seasonName, index, field, element) => {
    let val = element.innerText.trim();
    if(field === 'amount' || field === 'oneplus' || field === 'reverse') val = val.replace(/[^0-9]/g, ''); 
    
    if(!window.seasonData[seasonName][index]) return;
    window.seasonData[seasonName][index][field] = val;

    if(field === 'amount') {
        const row = element.closest('.record-row');
        row.style.background = getLevelColor(val);
    }
    
    // í•©ê³„ ì¬ê³„ì‚°
    if(['amount','oneplus','reverse','id','nick'].includes(field)) {
        recalculateSums(seasonName);
    }
  };

  window.handleBlur = () => { window.saveSeason(); };

  function recalculateSums(seasonName) {
      let cnt = 0, nang = 0, one = 0, rev = 0;
      window.seasonData[seasonName].forEach(item => {
          if(item.id || item.nick) cnt++;
          nang += parseInt(item.amount || 0);
          one += parseInt(item.oneplus || 0);
          rev += parseInt(item.reverse || 0);
      });
      updateSumDisplay(cnt, nang, one, rev);
  }

  window.cloneRow = (index) => {
    if(!window.currentSeasonName) return;
    const newItem = { id:'', nick:'', amount:'', oneplus:'', promise:'', reverse:'', note:'' };
    window.seasonData[window.currentSeasonName].splice(index + 1, 0, newItem);
    window.saveSeason();
    renderRecordTable(window.currentSeasonName);
  };

  window.addEmptyRowAtEnd = () => {
    if(!window.currentSeasonName) return;
    const newItem = { id:'', nick:'', amount:'', oneplus:'', promise:'', reverse:'', note:'' };
    window.seasonData[window.currentSeasonName].push(newItem);
    window.saveSeason();
    renderRecordTable(window.currentSeasonName);
  };

  window.removeRow = (index) => {
    if(!window.currentSeasonName) return;
    const list = window.seasonData[window.currentSeasonName];
    if(list.length <= 1) { alert("ìµœì†Œ 1ì¤„ì€ ìœ ì§€í•´ì•¼ í•©ë‹ˆë‹¤."); return; }
    if(!confirm("ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) return;
    list.splice(index, 1);
    window.saveSeason();
    renderRecordTable(window.currentSeasonName);
  };

  window.deleteCurrentSeason = () => {
    if(!confirm("ì´ ì‹œì¦Œì„ ì™„ì „íˆ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) return;
    delete window.seasonData[window.currentSeasonName];
    window.currentSeasonName = null;
    window.saveSeason();
  };

  // ì—‘ì…€ ë¶™ì—¬ë„£ê¸° (7ì—´ ì§€ì›: ID,ë‹‰,ë‚­,1+1,ê³µì•½,ì—­íŒ¬,ë¹„ê³ )
  document.addEventListener('paste', (e) => {
    if(!document.getElementById('page-record').classList.contains('active')) return;
    if(!window.currentSeasonName) return;
    if(e.target.isContentEditable || e.target.tagName === 'INPUT') return;

    e.preventDefault();
    const clipboardData = (e.clipboardData || window.clipboardData).getData('text');
    if(!clipboardData) return;

    const rows = clipboardData.trim().split(/\r?\n/);
    if(rows.length === 0) return;

    if(!confirm(`${rows.length}í–‰ì˜ ë°ì´í„°ë¥¼ ë¶™ì—¬ë„£ìœ¼ì‹œê² ìŠµë‹ˆê¹Œ?`)) return;

    rows.forEach(rowStr => {
        const cols = rowStr.split('\t');
        if(cols.length < 1) return;
        const newItem = {
            id: cols[0] || '',
            nick: cols[1] || '',
            amount: (cols[2] || '').replace(/[^0-9]/g, ''), 
            oneplus: (cols[3] || '').replace(/[^0-9]/g, ''),
            promise: cols[4] || '',
            reverse: (cols[5] || '').replace(/[^0-9]/g, ''),
            note: cols[6] || ''
        };
        window.seasonData[window.currentSeasonName].push(newItem);
    });

    window.saveSeason();
    renderRecordTable(window.currentSeasonName);
  });

  // --- ìº˜ë¦°ë” ë¡œì§ ---
  window.currentDate = new Date();
  window.selectedDateKey = null;
  window.currentTaskIndex = null;
  window.isEditMode = false;

  function refreshCalendarUI() {
    renderCalendar();
    renderSidebar();
    renderTotalRanking();
    if(window.selectedDateKey) renderNickList(window.homeworkData[window.selectedDateKey] || []);
  }

  window.renderCalendar = () => {
    const year = window.currentDate.getFullYear();
    const month = window.currentDate.getMonth();
    document.getElementById('current-month').innerText = `${year}ë…„ ${month+1}ì›”`;
    const el = document.getElementById('calendar'); el.innerHTML = '';
    const firstDay = new Date(year, month, 1).getDay();
    const lastDate = new Date(year, month+1, 0).getDate();
    ['ì¼','ì›”','í™”','ìˆ˜','ëª©','ê¸ˆ','í† '].forEach(d => el.innerHTML+=`<div class="day-name">${d}</div>`);
    for(let i=0; i<firstDay; i++) el.innerHTML+=`<div></div>`;
    for(let i=1; i<=lastDate; i++) {
        const dKey = `${year}-${String(month+1).padStart(2,'0')}-${String(i).padStart(2,'0')}`;
        const count = (window.homeworkData[dKey]||[]).length;
        const cls = count>0 ? 'has-homework' : '';
        const badge = count>0 ? `<div class="hw-badge">${count}</div>` : '';
        el.innerHTML += `<div class="day-cell ${cls}" onclick="selectDate('${dKey}')"><span class="day-number">${i}</span>${badge}</div>`;
    }
  };

  window.changeMonth = (step) => { 
      window.currentDate.setDate(1); 
      window.currentDate.setMonth(window.currentDate.getMonth()+step); 
      window.renderCalendar(); 
  };
  
  window.selectDate = (key) => {
    window.selectedDateKey = key;
    const titleEl = document.getElementById('selected-date-text');
    if(titleEl) titleEl.innerText = `${key} ë¦¬ìŠ¤íŠ¸`;
    renderNickList(window.homeworkData[key]||[]);
    document.getElementById('nickname-view').style.display='block';
    document.getElementById('detail-card').style.display='none';
    document.getElementById('add-form').style.display='none';
  };

  window.renderNickList = (list) => {
    const con = document.getElementById('nick-list-container'); con.innerHTML = '';
    if(!list.length) { con.innerHTML = '<div style="grid-column:span 3; text-align:center; color:#ccc;">ì—†ìŒ</div>'; return; }
    list.forEach((task, idx) => {
        const btn = document.createElement('button');
        btn.className = `nick-btn status-${task.status || 'todo'}`;
        btn.innerText = task.nick;
        btn.onclick = () => showMemberDetail(task, idx);
        con.appendChild(btn);
    });
  };

  window.renderSidebar = () => {
    const con = document.getElementById('sidebar-list'); con.innerHTML = '';
    Object.keys(window.homeworkData).sort().reverse().forEach(key => {
        if(window.homeworkData[key].length > 0) {
            const div = document.createElement('div');
            div.className = 'shortcut-btn';
            div.innerHTML = `<span class="shortcut-date">${key}</span><span class="shortcut-count">${window.homeworkData[key].length}ê±´</span>`;
            div.onclick = () => { window.currentDate = new Date(key); window.renderCalendar(); window.selectDate(key); };
            con.appendChild(div);
        }
    });
  };

  window.renderTotalRanking = () => {
    const con = document.getElementById('total-rank-list'); con.innerHTML = '';
    const counts = {};
    Object.keys(window.homeworkData).forEach(d => window.homeworkData[d].forEach(t => {
        if(!counts[t.id]) counts[t.id] = {nick:t.nick, id:t.id, count:0};
        counts[t.id].count++;
    }));
    const sorted = Object.values(counts).sort((a,b)=>b.count-a.count);
    if(!sorted.length) { con.innerHTML='<div class="no-data-msg">ë°ì´í„° ì—†ìŒ</div>'; return; }
    sorted.forEach((u,i) => {
        let icon = i===0?'ğŸ‘‘ ':i===1?'ğŸ¥ˆ ':i===2?'ğŸ¥‰ ': `${i+1}. `;
        const div = document.createElement('div');
        div.className = 'rank-item';
        div.innerHTML = `<div class="rank-info"><span class="rank-nick">${icon}${u.nick}</span><span class="rank-id">(${u.id})</span></div><div class="rank-badge">${u.count}ê°œ</div>`;
        con.appendChild(div);
    });
  };

  window.toggleAddForm = () => {
    window.isEditMode = false;
    document.getElementById('add-form').style.display = 'block';
    document.getElementById('new-date').value = window.selectedDateKey || '';
    document.getElementById('new-nick').value = '';
    document.getElementById('new-id').value = '';
    document.getElementById('new-amount').value = '';
    document.getElementById('new-reverse').value = '';
    document.getElementById('new-content').value = '';
    const btn = document.getElementById('btn-submit');
    btn.innerText = "ë“±ë¡ ì™„ë£Œ ğŸ’–";
    btn.classList.remove('edit-mode');
  };

  window.openEditForm = () => {
    window.isEditMode = true;
    const task = window.homeworkData[window.selectedDateKey][window.currentTaskIndex];
    document.getElementById('add-form').style.display = 'block';
    document.getElementById('new-date').value = window.selectedDateKey;
    document.getElementById('new-nick').value = task.nick;
    document.getElementById('new-id').value = task.id;
    document.getElementById('new-amount').value = task.amount;
    document.getElementById('new-reverse').value = task.reverse;
    document.getElementById('new-content').value = task.content;
    const ratio = (task.amount > 0) ? (task.reverse / task.amount) : 0.03;
    if(ratio >= 0.09) document.querySelector('input[name="calc-ratio"][value="0.10"]').checked = true;
    else document.querySelector('input[name="calc-ratio"][value="0.03"]').checked = true;
    const btn = document.getElementById('btn-submit');
    btn.innerText = "ìˆ˜ì • ì™„ë£Œ ğŸ”„";
    btn.classList.add('edit-mode');
    document.getElementById('detail-card').style.display = 'none';
  };

  window.autoCalculate = () => {
    const amt = document.getElementById('new-amount').value;
    const ratio = document.querySelector('input[name="calc-ratio"]:checked').value;
    document.getElementById('new-reverse').value = Math.floor(amt * ratio);
  };

  window.handleTaskSubmit = () => {
    const dKey = document.getElementById('new-date').value;
    if(!dKey) return alert("ë‚ ì§œ í•„ìˆ˜");
    const newTask = {
        nick: document.getElementById('new-nick').value,
        id: document.getElementById('new-id').value,
        amount: document.getElementById('new-amount').value,
        reverse: document.getElementById('new-reverse').value,
        content: document.getElementById('new-content').value,
        status: 'todo', memo: ''
    };

    if(window.isEditMode) {
        const oldTask = window.homeworkData[window.selectedDateKey][window.currentTaskIndex];
        newTask.status = oldTask.status;
        newTask.memo = oldTask.memo;

        if(dKey !== window.selectedDateKey) {
            window.homeworkData[window.selectedDateKey].splice(window.currentTaskIndex, 1);
            if(!window.homeworkData[dKey]) window.homeworkData[dKey] = [];
            window.homeworkData[dKey].push(newTask);
            alert("ë‚ ì§œ ì´ë™ë¨!");
        } else {
            window.homeworkData[dKey][window.currentTaskIndex] = newTask;
        }
    } else {
        if(!window.homeworkData[dKey]) window.homeworkData[dKey] = [];
        window.homeworkData[dKey].push(newTask);
    }
    
    window.saveHomework();
    document.getElementById('add-form').style.display = 'none';
    if(dKey===window.selectedDateKey) window.selectDate(dKey);
    else window.renderCalendar();
  };

  window.showMemberDetail = (task, idx) => {
    window.currentTaskIndex = idx;
    document.getElementById('detail-card').style.display = 'block';
    document.getElementById('detail-nick').innerText = task.nick;
    document.getElementById('detail-id').innerText = `@${task.id}`;
    document.getElementById('detail-amount').innerText = parseInt(task.amount).toLocaleString();
    document.getElementById('detail-reverse').innerText = parseInt(task.reverse).toLocaleString();
    document.getElementById('detail-content').innerText = task.content;
    document.getElementById('detail-memo').value = task.memo || '';
    const radios = document.getElementsByName('status');
    for(let r of radios) { r.checked = (r.value === task.status); }
    document.getElementById('detail-link').href = `https://www.sooplive.co.kr/station/${task.id}`;
  };

  window.saveTaskStatus = (showMsg=false) => {
    if(!window.selectedDateKey) return;
    const task = window.homeworkData[window.selectedDateKey][window.currentTaskIndex];
    task.memo = document.getElementById('detail-memo').value;
    const radios = document.getElementsByName('status');
    for(let r of radios) { if(r.checked) task.status = r.value; }
    window.saveHomework();
    if(showMsg) alert("ì €ì¥ë¨!");
    window.renderNickList(window.homeworkData[window.selectedDateKey]);
  };

  window.completeAndDelete = () => {
    if(!confirm("ì™„ë£Œ ì²˜ë¦¬í•˜ì‹œê² ìŠµë‹ˆê¹Œ? (ì‚­ì œ)")) return;
    window.deleteTask();
  };

  window.deleteTask = () => {
    window.homeworkData[window.selectedDateKey].splice(window.currentTaskIndex, 1);
    window.saveHomework();
    window.closeDetail();
    window.selectDate(window.selectedDateKey);
  };

  window.closeDetail = () => {
      document.getElementById('detail-card').style.display = 'none';
      document.getElementById('add-form').style.display = 'none';
  }

</script>

</body>
</html>

<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ğŸ° ë‚­ - ìˆ™ì œ ì²´í¬</title>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore-compat.js"></script>

<style>
    body {
        background: linear-gradient(180deg, #ffe0f0 0%, #fff5fb 100%);
        font-family: Pretendard, sans-serif;
        margin: 0;
        padding: 20px;
    }

    h1 {
        text-align: center;
        color: #ff6fa8;
        margin-bottom: 5px;
    }

    .tag {
        text-align: center;
        font-size: 13px;
        color: #fff;
        background: #ff9ac5;
        padding: 4px 12px;
        border-radius: 999px;
        display: inline-block;
        margin-left: 50%;
        transform: translateX(-50%);
        margin-bottom: 18px;
    }

    table {
        width: 100%;
        border-collapse: collapse;
        background: #ffffff;
        border-radius: 14px;
        overflow: hidden;
        box-shadow: 0 3px 12px rgba(255, 140, 170, 0.25);
    }

    th {
        background: #ff9ac5;
        padding: 10px;
        color: #fff;
        font-weight: 600;
        text-align: center;
    }

    td {
        border-bottom: 1px solid #ffc9dd;
        padding: 10px;
        text-align: center;
    }

    input[type="checkbox"] {
        width: 22px;
        height: 22px;
        accent-color: #ff6fa8;
        cursor: pointer;
    }

    input[type="text"] {
        border: 1px solid #ffc9dd;
        border-radius: 8px;
        padding: 6px;
        width: 90%;
    }

    textarea {
        width: 95%;
        min-height: 50px;
        border: 1px solid #ffc9dd;
        border-radius: 8px;
        padding: 6px;
        resize: vertical;
        font-family: inherit;
    }
</style>
</head>

<body>

<h1>ğŸ° ë‚­ - ìˆ™ì œ ì²´í¬</h1>
<div class="tag">ì‚¬ìš©ì ID: ë‚­ (í•‘í¬)</div>

<table id="table">
    <thead id="thead"></thead>
    <tbody id="tbody"></tbody>
</table>

<script>
const firebaseConfig = {
    apiKey: "AIzaSyAHmLNi5VOuAE-gXnAg-fEfzylPZvzvfVo",
    authDomain: "daily-checklist-91e5a.firebaseapp.com",
    projectId: "daily-checklist-91e5a",
    storageBucket: "daily-checklist-91e5a.firebasestorage.app",
    messagingSenderId: "66394691958",
    appId: "1:66394691958:web:cf91f295456a2e10d18257",
    measurementId: "G-87WK4N4EGH"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

const configRef = db.collection("config").doc("checklist");
const spacesRef = db.collection("spaces");

let fields = [];

configRef.onSnapshot(doc => {
    if (!doc.exists) return;
    fields = doc.data().fields;
    renderTable();
});

spacesRef.onSnapshot(snapshot => {
    renderTable();
});

function renderTable() {
    const thead = document.getElementById("thead");
    const tbody = document.getElementById("tbody");

    thead.innerHTML = `
        <tr>
            <th>ë‹‰ë„¤ì„</th>
            <th>ì•„ì´ë””</th>
            ${fields.map(f => `<th>${f}</th>`).join("")}
            <th>ë©”ëª¨</th>
        </tr>
    `;

    tbody.innerHTML = "";

    spacesRef.get().then(res => {
        res.forEach(doc => {
            const data = doc.data();
            const checks = data.checks || {};

            const row = document.createElement("tr");

            row.innerHTML = `
                <td><input value="${data.nickname}" onchange="update('${doc.id}', 'nickname', this.value)"></td>
                <td><input value="${data.userid}" onchange="update('${doc.id}', 'userid', this.value)"></td>
                ${fields.map(f => `
                    <td>
                        <input type="checkbox" 
                            ${checks[f] ? "checked" : ""} 
                            onchange="updateCheck('${doc.id}', '${f}', this.checked)">
                    </td>
                `).join("")}
                <td>
                    <textarea onchange="update('${doc.id}', 'memo', this.value)">${data.memo || ""}</textarea>
                </td>
            `;

            tbody.appendChild(row);
        });
    });
}

function update(docID, field, value) {
    spacesRef.doc(docID).update({ [field]: value });
}

function updateCheck(docID, field, value) {
    spacesRef.doc(docID).update({
        [`checks.${field}`]: value
    });
}
</script>

</body>
</html>

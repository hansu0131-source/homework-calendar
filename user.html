<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ğŸ° ë‚­ - ìˆ™ì œ ì²´í¬</title>

<!-- Firebase compat SDK -->
<script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore-compat.js"></script>

<style>
    * { box-sizing: border-box; }
    body {
        background: #FFF0F6;
        font-family: -apple-system, BlinkMacSystemFont, "Pretendard", system-ui, sans-serif;
        margin: 0;
        padding: 16px;
        color: #4b3242;
    }

    h1 {
        text-align: center;
        color: #ff6fa8;
        margin: 0 0 6px 0;
        font-size: 22px;
    }

    .tag {
        text-align: center;
        font-size: 12px;
        color: #fff;
        background: #ff9ac5;
        padding: 4px 12px;
        border-radius: 999px;
        display: inline-block;
        margin-left: 50%;
        transform: translateX(-50%);
        margin-bottom: 18px;
    }

    .section-title {
        font-size: 15px;
        font-weight: 700;
        margin-bottom: 8px;
        color: #ff6fa8;
        display: flex;
        align-items: center;
        gap: 6px;
    }

    .section-title span.sub { font-size: 12px; color: #b86285; }

    .card {
        background: #ffffff;
        padding: 12px;
        border-radius: 14px;
        box-shadow: 0 3px 10px rgba(255,120,160,0.22);
        margin-bottom: 16px;
    }

    textarea {
        width: 100%;
        min-height: 70px;
        border-radius: 10px;
        border: 1px solid #ffc7de;
        padding: 8px;
        resize: vertical;
        font-family: inherit;
        font-size: 13px;
        background: #fff6fb;
    }

    button {
        padding: 8px 14px;
        border: none;
        border-radius: 999px;
        background: #ff6fa8;
        color: white;
        font-weight: 600;
        cursor: pointer;
        font-size: 13px;
    }

    button:active { transform: translateY(1px); }

    .btn-sub {
        background: #ffd0e4;
        color: #b23e6c;
    }

    .badge-nick {
        font-size: 13px;
        font-weight: 600;
        padding: 4px 10px;
        border-radius: 999px;
        background: #ffe3ef;
        color: #8b3d5f;
    }

    .badge-id {
        font-size: 11px;
        padding: 4px 8px;
        border-radius: 999px;
        background: #fff1f7;
        color: #a84b78;
        display: inline-flex;
        align-items: center;
        gap: 4px;
    }

    .badge-id button {
        padding: 2px 6px;
        font-size: 10px;
        border-radius: 999px;
        background: #ff9ac5;
        color: #fff;
    }

    .space-card {
        margin-bottom: 10px;
        padding: 10px;
        border-radius: 12px;
        background: #fffdfd;
        border: 1px solid #ffd6e7;
        box-shadow: 0 2px 6px rgba(0,0,0,0.03);
        word-break: break-all;
        overflow-wrap: break-word;
    }

    .space-main { display: flex; flex-direction: column; gap: 6px; }

    .space-fields {
        display: flex;
        flex-wrap: wrap;
        gap: 6px;
    }

    .field-chip {
        display: inline-flex;
        align-items: center;
        gap: 4px;
        padding: 4px 8px;
        border-radius: 999px;
        background: #fff1f6;
        font-size: 11px;
    }

    .field-chip input[type="checkbox"] {
        width: 16px; height: 16px;
        accent-color: #ff6fa8;
        margin: 0;
    }

    @media (min-width: 720px) {
        body { max-width: 640px; margin: 0 auto; }
    }

</style>
</head>

<body>

<h1>ğŸ° ë‚­ - ìˆ™ì œ ì²´í¬</h1>
<div class="tag">ì‚¬ìš©ì ID: ë‚­ (í•‘í¬)</div>

<!-- ì˜¤ëŠ˜ì˜ í•œë§ˆë”” -->
<div class="card">
    <div class="section-title">ğŸ“Œ ì˜¤ëŠ˜ì˜ í•œë§ˆë”” <span class="sub">(ê´€ë¦¬ì â†” ì‚¬ìš©ì)</span></div>

    <div style="font-size:12px; margin-bottom:4px;">ğŸ¥• ê´€ë¦¬ì â†’ ì‚¬ìš©ì</div>
    <div id="adminMessageBox" style="white-space:pre-line; padding:8px; border-radius:10px; 
    border:1px solid #ffc7de; background:#fff6fb; font-size:13px;">
        (ì•„ì§ ê´€ë¦¬ì ë©”ì‹œì§€ê°€ ì—†ìŠµë‹ˆë‹¤)
    </div>

    <div style="height:10px;"></div>

    <div style="font-size:12px; margin-bottom:4px;">ğŸ° ì‚¬ìš©ì â†’ ê´€ë¦¬ì</div>
    <textarea id="userMessage" placeholder="ì˜¤ëŠ˜ í•˜ê³  ì‹¶ì€ ë§â€¦"></textarea>

    <div style="text-align:right; margin-top:6px;">
        <button onclick="saveUserMessage()">ì‚¬ìš©ì í•œë§ˆë”” ì €ì¥</button>
    </div>
</div>

<!-- ì˜¤ëŠ˜ ìš”ì•½ (ë³´ê¸°ë§Œ ê°€ëŠ¥) -->
<div class="card">
    <div class="section-title">ğŸ“Š ì˜¤ëŠ˜ ìˆ™ì œ ìš”ì•½</div>

    <div id="summaryTodayBox" style="font-size:13px; white-space:pre-line;"></div>
</div>

<!-- ëˆ„ì  ìš”ì•½ (ë³´ê¸°ë§Œ ê°€ëŠ¥) -->
<div class="card">
    <div class="section-title">ğŸ“Š ëˆ„ì  ìˆ™ì œ ìš”ì•½</div>
    <div id="summaryTotalBox" style="font-size:13px; white-space:pre-line;"></div>
</div>

<!-- ì²´í¬ ì¹´ë“œë“¤ -->
<div class="card">
    <div class="section-title">ğŸ“¦ ìˆ™ì œ ì¹´ë“œ ëª©ë¡</div>
    <div id="spacesContainer"></div>
</div>

<script>
/* Firebase ì´ˆê¸°í™” */
const firebaseConfig = {
    apiKey: "AIzaSyAHmLNi5VOuAE-gXnAg-fEfzylPZvzvfVo",
    authDomain: "daily-checklist-91e5a.firebaseapp.com",
    projectId: "daily-checklist-91e5a",
    storageBucket: "daily-checklist-91e5a.firebasestorage.app",
    messagingSenderId: "66394691958",
    appId: "1:66394691958:web:cf91f295456a2e10d18257"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

const todayMessagesRef = db.collection("today").doc("messages");
const summaryTodayRef  = db.collection("summary").doc("today");
const summaryTotalRef  = db.collection("summary").doc("total");
const configRef        = db.collection("config").doc("checklist");
const spacesRef        = db.collection("spaces");

/*** ì˜¤ëŠ˜ì˜ í•œë§ˆë”” í‘œì‹œ ***/
todayMessagesRef.onSnapshot(doc => {
    if (!doc.exists) return;
    const data = doc.data();
    document.getElementById("adminMessageBox").innerText =
        data.adminMessage || "(ì•„ì§ ê´€ë¦¬ì ë©”ì‹œì§€ê°€ ì—†ìŠµë‹ˆë‹¤)";
});

/*** ì‚¬ìš©ì ë©”ì‹œì§€ ì €ì¥ ***/
function saveUserMessage() {
    const msg = document.getElementById("userMessage").value;
    todayMessagesRef.set({ userMessage: msg }, { merge: true })
    .then(() => alert("ë©”ì‹œì§€ë¥¼ ë³´ëƒˆì–´ìš”!"))
    .catch(err => alert("ì˜¤ë¥˜ê°€ ë°œìƒí–ˆì–´ìš”."));
}

/*** ì˜¤ëŠ˜ ìš”ì•½ í‘œì‹œ ***/
summaryTodayRef.onSnapshot(doc => {
    if (!doc.exists) return;
    const d = doc.data();
    document.getElementById("summaryTodayBox").innerText =
`
ì—­íŒ¬: ${d["ì—­íŒ¬"] ?? 0}
ë°©ì…€: ${d["ë°©ì…€"] ?? 0}
ìˆ™ì œ: ${d["ìˆ™ì œ"] ?? 0}
ì‚¬ì§„: ${d["ì‚¬ì§„"] ?? 0}
ì›€ì§¤: ${d["ì›€ì§¤"] ?? 0}
`;
});

/*** ëˆ„ì  ìš”ì•½ í‘œì‹œ ***/
summaryTotalRef.onSnapshot(doc => {
    if (!doc.exists) return;
    const d = doc.data();
    document.getElementById("summaryTotalBox").innerText =
`
ì—­íŒ¬: ${d["ì—­íŒ¬"] ?? 0}
ë°©ì…€: ${d["ë°©ì…€"] ?? 0}
ìˆ™ì œ: ${d["ìˆ™ì œ"] ?? 0}
ì‚¬ì§„: ${d["ì‚¬ì§„"] ?? 0}
ì›€ì§¤: ${d["ì›€ì§¤"] ?? 0}
`;
});

/*** í•­ëª© ë¦¬ìŠ¤íŠ¸ + íšŒì› ì •ë³´ + ì²´í¬ ***/
let fields = [];
configRef.onSnapshot(doc => {
    if (!doc.exists) return;
    fields = doc.data().fields || [];
    renderSpaces();
});

let spacesData = [];
spacesRef.onSnapshot(snapshot => {
    spacesData = snapshot.docs.map(d => ({ id: d.id, ...d.data() }));
    renderSpaces();
});

/*** ì•„ì´ë”” ë³µì‚¬ ***/
function copyUserId(val) {
    navigator.clipboard.writeText(val)
    .then(() => alert("ë³µì‚¬í–ˆì–´ìš”!"))
    .catch(() => alert("ë³µì‚¬ ì‹¤íŒ¨â€¦ ì§ì ‘ ë³µì‚¬í•´ì£¼ì„¸ìš”."));
}

/*** ì²´í¬ ì—…ë°ì´íŠ¸ ***/
function updateSpaceCheck(docId, field, checked) {
    spacesRef.doc(docId).update({ ["checks."+field]: checked });
}

/*** ë Œë”ë§ ***/
function renderSpaces() {
    const container = document.getElementById("spacesContainer");
    container.innerHTML = "";

    spacesData.forEach(item => {
        const checks = item.checks || {};
        const card = document.createElement("div");
        card.className = "space-card";

        card.innerHTML = `
            <div class="space-main">
                <div class="badge-nick">ë‹‰ë„¤ì„: ${item.nickname}</div>
                <div class="badge-id">
                    <span>${item.userid}</span>
                    <button onclick="copyUserId('${item.userid}')">ë³µì‚¬</button>
                </div>
            </div>

            <div class="space-fields">
                ${fields.map(f => `
                    <div class="field-chip">
                        <input type="checkbox"
                               ${checks[f] ? "checked" : ""}
                               onchange="updateSpaceCheck('${item.id}', '${f}', this.checked)">
                        <span>${f}</span>
                    </div>
                `).join("")}
            </div>

            <div style="font-size:12px; margin-top:6px;">ë©”ëª¨</div>
            <textarea disabled>${item.memo || ""}</textarea>
        `;

        container.appendChild(card);
    });
}
</script>

</body>
</html>
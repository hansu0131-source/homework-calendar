<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ğŸ° ë‚­ - ìˆ™ì œ ì²´í¬</title>

<!-- Firebase compat SDK -->
<script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore-compat.js"></script>

<style>
    * { box-sizing:border-box; }

    body {
        background:#FFEAF4;
        font-family:-apple-system,BlinkMacSystemFont,"Pretendard",system-ui,sans-serif;
        margin:0; padding:16px; color:#633f52;
    }

    h1 {
        text-align:center; color:#ff66a6;
        margin:0 0 8px; font-size:22px;
    }

    .tag {
        display:inline-block;
        background:#ff9ac5;
        color:white;
        padding:4px 12px;
        border-radius:999px;
        font-size:12px;
        margin-left:50%;
        transform:translateX(-50%);
        margin-bottom:18px;
    }

    .card {
        background:white;
        border-radius:16px;
        padding:12px;
        margin-bottom:18px;
        box-shadow:0 3px 12px rgba(255,135,180,0.25);
    }

    .section-title {
        font-size:15px; font-weight:700;
        margin-bottom:10px; color:#ff66a6;
        display:flex; align-items:center; gap:6px;
    }

    textarea {
        width:100%; min-height:70px;
        border:1px solid #ffc7dd;
        border-radius:10px;
        padding:8px;
        font-size:13px;
        resize:vertical;
        background:#fff7fb;
    }

    input[type="number"] {
        width:100%; padding:6px;
        border:1px solid #ffc7dd;
        border-radius:8px;
        font-size:12px;
        background:#fff7fb;
        text-align:center;
    }

    .summary-table {
        width:100%; border-collapse:collapse;
        margin-top:6px; font-size:12px;
    }

    .summary-table th, .summary-table td {
        border:1px solid #ffd3e4;
        padding:4px 6px; text-align:center;
        white-space:nowrap;
    }

    .summary-table th {
        background:#ffd8e9; color:#884b6a;
        font-weight:600;
    }

    .label-top { font-size:12px; color:#8e5c74; margin-bottom:4px; }

    .space-card {
        padding:12px;
        background:white;
        border-radius:14px;
        border:1px solid #ffd3e4;
        box-shadow:0 2px 6px rgba(0,0,0,0.06);
        margin-bottom:12px;
    }

    .badge-nick {
        display:inline-block;
        padding:6px 12px;
        background:#ffd8e9;
        border-radius:999px;
        font-size:14px; font-weight:600;
        color:#a4476f;
        margin-bottom:8px;
    }

    .badge-id {
        display:inline-flex;
        align-items:center;
        gap:6px;
        padding:6px 10px;
        background:#ffeef4;
        border-radius:999px;
        font-size:12px;
        margin-bottom:10px;
        color:#8a4d6b;
    }

    .badge-id button {
        padding:3px 8px;
        border:none;
        font-size:11px;
        background:#ff9ac5;
        color:white;
        border-radius:999px;
    }

    .space-fields {
        display:flex;
        flex-wrap:wrap;
        gap:8px;
        margin-bottom:10px;
    }

    .field-chip {
        display:inline-flex;
        align-items:center;
        gap:4px;
        padding:4px 8px;
        background:#ffeef4;
        border-radius:999px;
        font-size:12px;
        color:#8f4a6d;
    }

    .field-chip input[type="checkbox"] {
        width:18px; height:18px; accent-color:#ff66a6;
    }

    @media (min-width:720px){
        body{ max-width:640px; margin:0 auto; }
    }
</style>
</head>

<body>

<h1>ğŸ° ë‚­ - ìˆ™ì œ ì²´í¬</h1>
<div class="tag">ì‚¬ìš©ì ID: ë‚­ (í•‘í¬)</div>

<!-- ğŸ©· ì˜¤ëŠ˜ì˜ í•œë§ˆë”” -->
<div class="card">
    <div class="section-title">ğŸ“Œ ì˜¤ëŠ˜ì˜ í•œë§ˆë””</div>

    <div class="label-top">ğŸ¥• ê´€ë¦¬ì â†’ ì‚¬ìš©ìì˜ ë©”ì‹œì§€</div>
    <div id="adminMessageBox"
         style="white-space:pre-line; border-radius:10px; border:1px solid #ffcddf;
         background:#fff3f8; padding:10px; font-size:13px; min-height:50px;">
        (ì•„ì§ ê´€ë¦¬ì ë©”ì‹œì§€ê°€ ì—†ìŠµë‹ˆë‹¤)
    </div>

    <div style="height:12px;"></div>

    <div class="label-top">ğŸ° ì‚¬ìš©ì â†’ ê´€ë¦¬ì</div>
    <textarea id="userMessage" placeholder="ì˜¤ëŠ˜ í•˜ê³  ì‹¶ì€ ë§ì„ ì ì–´ì£¼ì„¸ìš”"></textarea>

    <div style="margin-top:6px; text-align:right;">
        <button onclick="saveUserMessage()">ì €ì¥</button>
    </div>
</div>

<!-- ğŸŒ¸ ì˜¤ëŠ˜ ìš”ì•½ -->
<div class="card">
    <div class="section-title">ğŸ“Š ì˜¤ëŠ˜ì˜ ìˆ™ì œ ìš”ì•½ (ì½ê¸° ì „ìš©)</div>
    <table class="summary-table">
        <tr>
            <th></th><th>ì—­íŒ¬</th><th>ë°©ì…€</th><th>ìˆ™ì œ</th><th>ì‚¬ì§„</th><th>ì›€ì§¤</th>
        </tr>
        <tr>
            <td style="background:#fff3f8;">ì˜¤ëŠ˜</td>
            <td id="today-ì—­íŒ¬">0</td>
            <td id="today-ë°©ì…€">0</td>
            <td id="today-ìˆ™ì œ">0</td>
            <td id="today-ì‚¬ì§„">0</td>
            <td id="today-ì›€ì§¤">0</td>
        </tr>
    </table>
</div>

<!-- ğŸŒ¸ ëˆ„ì  ìš”ì•½ -->
<div class="card">
    <div class="section-title">ğŸ“Š ëˆ„ì  ìˆ™ì œ ìš”ì•½ (ì½ê¸° ì „ìš©)</div>
    <table class="summary-table">
        <tr>
            <th></th><th>ì—­íŒ¬</th><th>ë°©ì…€</th><th>ìˆ™ì œ</th><th>ì‚¬ì§„</th><th>ì›€ì§¤</th>
        </tr>
        <tr>
            <td style="background:#fff3f8;">ëˆ„ì </td>
            <td id="total-ì—­íŒ¬">0</td>
            <td id="total-ë°©ì…€">0</td>
            <td id="total-ìˆ™ì œ">0</td>
            <td id="total-ì‚¬ì§„">0</td>
            <td id="total-ì›€ì§¤">0</td>
        </tr>
    </table>
</div>

<!-- ğŸŒ¸ ìˆ™ì œ ì¹´ë“œ -->
<div class="card">
    <div class="section-title">ğŸ“¦ ìˆ™ì œ ì¹´ë“œ</div>
    <div id="spacesContainer"></div>
</div>


<script>
/* Firebase ì´ˆê¸°í™” */
const firebaseConfig = {
    apiKey:"AIzaSyAHmLNi5VOuAE-gXnAg-fEfzylPZvzvfVo",
    authDomain:"daily-checklist-91e5a.firebaseapp.com",
    projectId:"daily-checklist-91e5a",
    storageBucket:"daily-checklist-91e5a.firebasestorage.app",
    messagingSenderId:"66394691958",
    appId:"1:66394691958:web:cf91f295456a2e10d18257",
    measurementId:"G-87WK4N4EGH"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

const todayMessagesRef = db.collection("today").doc("messages");
const summaryTodayRef  = db.collection("summary").doc("today");
const summaryTotalRef  = db.collection("summary").doc("total");
const configRef        = db.collection("config").doc("checklist");
const spacesRef        = db.collection("spaces");

let fields = [];
let spacesData = [];

/* ê´€ë¦¬ì ë©”ì‹œì§€ ë¶ˆëŸ¬ì˜¤ê¸° */
todayMessagesRef.onSnapshot(doc=>{
    if(!doc.exists) return;
    const data = doc.data();
    document.getElementById("adminMessageBox").innerText =
        data.adminMessage || "(ì•„ì§ ê´€ë¦¬ì ë©”ì‹œì§€ê°€ ì—†ìŠµë‹ˆë‹¤)";
    document.getElementById("userMessage").value =
        data.userMessage || "";
});

/* ì‚¬ìš©ì ë©”ì‹œì§€ ì €ì¥ */
function saveUserMessage(){
    const msg = document.getElementById("userMessage").value;
    todayMessagesRef.set({ userMessage:msg },{merge:true});
    alert("ë©”ì‹œì§€ ì €ì¥ ì™„ë£Œ!");
}

/* ì˜¤ëŠ˜ ìš”ì•½ */
summaryTodayRef.onSnapshot(doc=>{
    if(!doc.exists) return;
    const data = doc.data();
    ["ì—­íŒ¬","ë°©ì…€","ìˆ™ì œ","ì‚¬ì§„","ì›€ì§¤"].forEach(a=>{
        document.getElementById("today-"+a).innerText = data[a] ?? 0;
    });
});

/* ëˆ„ì  ìš”ì•½ */
summaryTotalRef.onSnapshot(doc=>{
    if(!doc.exists) return;
    const data = doc.data();
    ["ì—­íŒ¬","ë°©ì…€","ìˆ™ì œ","ì‚¬ì§„","ì›€ì§¤"].forEach(a=>{
        document.getElementById("total-"+a).innerText = data[a] ?? 0;
    });
});

/* í•­ëª© */
configRef.onSnapshot(doc=>{
    fields = doc.data().fields || [];
    renderSpaces();
});

/* spaces */
spacesRef.onSnapshot(snapshot=>{
    spacesData = snapshot.docs.map(d=>({ id:d.id, ...d.data() }));
    renderSpaces();
});

/* ì²´í¬ ì—…ë°ì´íŠ¸ */
function updateCheck(id, field, value){
    spacesRef.doc(id).update({
        ["checks."+field]: value
    });
}

/* ë©”ëª¨ ì—…ë°ì´íŠ¸ */
function updateMemo(id, value){
    spacesRef.doc(id).update({ memo:value });
}

/* ID ë³µì‚¬ */
function copyUserId(v){
    navigator.clipboard.writeText(v).then(()=>{
        alert("ì•„ì´ë”” ë³µì‚¬ë¨: "+v);
    });
}

/* ì¹´ë“œ ë Œë” */
function renderSpaces(){
    const wrap = document.getElementById("spacesContainer");
    wrap.innerHTML="";

    if(!spacesData.length){
        wrap.innerHTML = '<div style="font-size:12px; color:#9c6982;">ë“±ë¡ëœ ìˆ™ì œ ëŒ€ìƒì´ ì—†ìŠµë‹ˆë‹¤.</div>';
        return;
    }

    spacesData.forEach(item=>{
        const checks = item.checks || {};

        wrap.innerHTML += `
            <div class="space-card">

                <div class="badge-nick">ë‹‰ë„¤ì„: ${item.nickname}</div>

                <div class="badge-id">
                    <span>ì•„ì´ë””: ${item.userid}</span>
                    <button onclick="copyUserId('${item.userid}')">ë³µì‚¬</button>
                </div>

                <div class="space-fields">
                    ${fields.map(f=>`
                        <div class="field-chip">
                            <input type="checkbox"
                                ${checks[f]?"checked":""}
                                onchange="updateCheck('${item.id}','${f}',this.checked)">
                            <span>${f}</span>
                        </div>
                    `).join("")}
                </div>

                <div class="label-top">ë©”ëª¨</div>
                <textarea onchange="updateMemo('${item.id}',this.value)">${item.memo||""}</textarea>

            </div>
        `;
    });
}
</script>

</body>
</html>